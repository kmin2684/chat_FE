(this.webpackJsonpchat_fe=this.webpackJsonpchat_fe||[]).push([[0],{101:function(e,t,n){},103:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),s=n(32),a=n.n(s),i=n(15),o=(n(101),n(31)),l=n(16),u=n(7),d=(n(102),n(103),n(78));function j(e){var t,n=0,c=Object(d.a)(e);try{for(c.s();!(t=c.n()).done;){n+=t.value.charCodeAt(0)}}catch(r){c.e(r)}finally{c.f()}return{0:"#313E50",1:"#924C5D",2:"#C5867A",3:"#E1915E",4:"#E17F5E",5:"#85A47A"}[n%6]}function h(e){var t,n,c,r,s,a,i,o;if("left"===e)i="left",o="right";else{if("right"!==e)return void console.log("invalide viewSide for MobileViewSide function");i="right",o="left"}var u=document.querySelector(".".concat(i)),d=u.classList.value.split(/(\s+)/).filter((function(e){return e.trim().length>0})),j=Object(l.a)(new Set(d)),h=j.filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)}));(t=u.classList).remove.apply(t,Object(l.a)(d)),(n=u.classList).add.apply(n,[].concat(Object(l.a)(h),["ShowIfMobile"]));var f=document.querySelector(".".concat(o));f?(console.log("side hidden",f),d=null===f||void 0===f||null===(c=f.classList)||void 0===c||null===(r=c.value)||void 0===r?void 0:r.split(/(\s+)/).filter((function(e){return e.trim().length>0})),h=(j=Object(l.a)(new Set(d))).filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)})),(s=f.classList).remove.apply(s,Object(l.a)(d)),(a=f.classList).add.apply(a,[].concat(Object(l.a)(h),["HideIfMobile"]))):console.log("no side to hide")}function f(e){"undefined"!==typeof Storage?(localStorage.ChatUserInfo=e?JSON.stringify(e):null,console.log("user info saved in local storage")):console.log("unable to use localStorage")}function b(e,t,n,c){var r=new URLSearchParams;return e&&r.append("section",e),t.forEach((function(e){c.includes(e)&&r.append("members",e)})),(null===n||void 0===n?void 0:n.trim())&&r.append("group_name",n),r.toString()}var m=n(1);function O(){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"spinner-border",role:"status",children:Object(m.jsx)("span",{className:"sr-only",children:"Loading..."})})})}var p=n(45),g=Object(p.b)({name:"userInfo",initialState:{username:null,token:null,isLoading:!0},reducers:{setUserInfo:function(e,t){e.username=t.payload.username,e.token=t.payload.token,e.isLoading=t.payload.isLoading||!1===t.payload.isLoading?t.payload.isLoading:e.isLoading}}}),v=g.actions,x=g,k=n(156),C=n(155),w=n(18),N="https://mk-chat-be.herokuapp.com";function y(e){var t=e.loggedIn,n=Object(w.f)(),r=Object(i.b)(),s=Object(c.useState)(""),a=Object(u.a)(s,2),o=a[0],l=a[1],d=Object(c.useState)(""),j=Object(u.a)(d,2),h=j[0],b=j[1],p=Object(c.useState)(!1),g=Object(u.a)(p,2),x=g[0],y=g[1];function S(e,t){"username"===t?l(e.target.value):"password"===t&&b(e.target.value)}function _(e){var t=void 0,n=void 0;console.log(e),1===e?(t="visitor1",n="123"):2===e&&(t="visitor2",n="123"),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}).then((function(e){return e.json()})).then((function(e){console.log(e),y(!1),e.token?(f({username:e.username,token:e.token}),r(v.setUserInfo({username:e.username,token:e.token}))):e.non_field_errors&&(console.log("error message",e.non_field_errors),alert(e.non_field_errors))}))}return t?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsxs)("div",{className:"login",children:[Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h})}).then((function(e){return y(!1),e.json()})).then((function(e){console.log(e),(null===e||void 0===e?void 0:e.token)?(f({username:e.username,token:e.token}),r(v.setUserInfo({username:e.username,token:e.token}))):(null===e||void 0===e?void 0:e.non_field_errors)&&(console.log("error message",e.non_field_errors),alert(e.non_field_errors))}))},className:"login-form",children:[Object(m.jsx)(C.a,{id:"outlined-basic",type:"text",placeholder:"id",autoComplete:"username",onChange:function(e){return S(e,"username")},value:o}),Object(m.jsx)(C.a,{id:"outlined-password-input",type:"password",autoComplete:"current-password",placeholder:"password",onChange:function(e){return S(e,"password")},value:h}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"log in"})]}),Object(m.jsx)("div",{children:"do not have an account yet?"}),Object(m.jsx)("div",{className:"creat-new-account",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return n.push("/register")},children:"Create a New Account"})}),Object(m.jsx)("div",{children:"want to try the app without registering?"}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(1)},children:"sign in as visitor1"})}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(2)},children:"sign in as visitor2"})}),x&&Object(m.jsx)(O,{})]})}function S(e){var t=e.loggedIn,n=Object(w.f)(),r=Object(i.b)(),s=Object(c.useState)(""),a=Object(u.a)(s,2),o=a[0],l=a[1],d=Object(c.useState)(""),j=Object(u.a)(d,2),h=j[0],b=j[1],p=Object(c.useState)(""),g=Object(u.a)(p,2),x=g[0],y=g[1],S=Object(c.useState)(!1),_=Object(u.a)(S,2),I=_[0],F=_[1];function E(e,t){"username"===t?l(e.target.value):"password"===t?b(e.target.value):"password2"==t&&y(e.target.value)}return t?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"registration",children:[I&&Object(m.jsx)(O,{}),Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),F(!0),fetch(N+"/chat_app/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h,password2:x})}).then((function(e){return F(!1),e.json()})).then((function(e){console.log(e);var t=Object.keys(e);t.find((function(e){return"token"===e}))?(f({username:e.username,token:e.token}),r(v.setUserInfo({username:e.username,token:e.token}))):t.find((function(e){return"error"===e}))&&(console.log("error message",e.error),alert(e.error))}))},children:[Object(m.jsx)(C.a,{id:"outlined-basic",autoComplete:"username",placeholder:"id",onChange:function(e){return E(e,"username")},value:o}),Object(m.jsx)(C.a,{id:"outlined-password-input",type:"password",autoComplete:"new-password",placeholder:"password",onChange:function(e){return E(e,"password")},value:h}),Object(m.jsx)(C.a,{id:"outlined-password-input 2",type:"password",autoComplete:"new-password",placeholder:"retype password",onChange:function(e){return E(e,"password2")},value:x}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"register"})]}),Object(m.jsxs)("div",{children:["Already registered? ",Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return n.push("/login")},children:"Go to sign in page"})]})]})})}var _=n(66),I=n.p+"static/media/x-lg.db763ca8.svg",F=n.p+"static/media/info.f4a46c68.svg",E=Object(p.b)({name:"status",initialState:{chats:[],friends:[],currentChat:null,chatHistory:null},reducers:{setChats:function(e,t){e.chats=t.payload.chats},addChat:function(e,t){e.chats.push(t.payload)},setFriends:function(e,t){e.friends=t.payload.friends},addFriend:function(e,t){e.friends.push(t.payload)},setCurrentChat:function(e,t){e.currentChat=t.payload},setChatHistory:function(e,t){e.chatHistory=t.payload}}}),P=E.actions,L=E,T=n(161),A=n(158);n(108);function H(e){var t=e.friend,n=e.onClickFriend,c=e.checked,r=e.changeCheck,s=e.isFriend,a=e.addFriend,i={backgroundColor:j(t)};return r||a?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend additional-field",onClick:function(){return n(t)},children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]}),r&&Object(m.jsx)("input",{type:"checkbox",checked:c,onChange:r}),a&&Object(m.jsx)(k.a,{value:t,disabled:s,onClick:function(e){return a(e)},children:s?"added":"add"})]})}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend",onClick:function(){return n(t)},children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]})})}function U(e){var t=Object(i.c)((function(e){var t;return null===(t=e.status.chatHistory)||void 0===t?void 0:t.members}));return t?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(T.a,{open:e.modalOpen,onClose:function(){return e.setModalOpenProp(!1)},container:function(){return document.querySelector(".chat-window")},style:{position:"absolute"},BackdropProps:{style:{position:"absolute"}},componentsProps:{style:{padding:"100"}},children:[Object(m.jsx)(A.a,{children:"members"}),t.map((function(e){return Object(m.jsx)(H,{friend:e,onClickFriend:function(){}},e)}))]})}):null}n(109);function M(e){var t,n=e.inputOn,r=e.socket,s=e.newChatData,a=e.mobileViewSide,d=Object(w.h)().room_id,j=Object(i.b)(),f=Object(w.f)(),b=Object(i.c)((function(e){return e.userInfo})),O=Object(i.c)((function(e){return e.status.chatHistory})),p=Object(i.c)((function(e){return e.status.currentChat})),g=Object(i.c)((function(e){return e.status.chats})),v=Object(c.useState)(null),x=Object(u.a)(v,2),k=x[0],N=x[1],y=Object(c.useState)(""),S=Object(u.a)(y,2),E=S[0],L=S[1],T=Object(c.useRef)(null),A=Object(c.useState)(!1),H=Object(u.a)(A,2),M=H[0],J=H[1],D=Object(c.useState)(!1),q=Object(u.a)(D,2),G=q[0],R=q[1];Object(c.useEffect)((function(){T.current.scrollTop=T.current.scrollHeight}),[O]),Object(c.useEffect)((function(){a&&h(a)}),[a]),Object(c.useEffect)((function(){return j(d?P.setCurrentChat(d):P.setCurrentChat(null)),function(){j(P.setCurrentChat(null))}}),[d,j]),Object(c.useEffect)((function(){(null===s||void 0===s?void 0:s.groupName)?N(s.groupName):(null===s||void 0===s?void 0:s.members)?N(s.members[0]):N(function(e,t,n){var c,r,s,a;if(e)return(null===(c=r=null===t||void 0===t?void 0:t.find((function(t){return t.id==e})))||void 0===c?void 0:c.name)?r.name:null===(s=r)||void 0===s||null===(a=s.members)||void 0===a?void 0:a.find((function(e){return e!==(null===n||void 0===n?void 0:n.username)}))}(p,g,b))}),[p,s,g,b]),Object(c.useEffect)((function(){if(null===s||void 0===s?void 0:s.members){var e=[].concat(Object(l.a)(s.members),[b.username]);j(P.setCurrentChat({newChatMembers:e}))}}),[s,b.username,j]);var V=null===O||void 0===O||null===(t=O.messages)||void 0===t?void 0:t.map((function(e){return b.username===e.sender?Object(m.jsxs)("div",{className:"message-block self",children:[Object(m.jsx)("div",{className:"container",children:Object(m.jsx)("div",{className:"content",children:e.content})}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time):Object(m.jsxs)("div",{className:"message-block other",children:[Object(m.jsx)("div",{className:"sender",children:e.sender}),Object(m.jsx)("div",{className:"content",children:e.content}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time)}));return Object(m.jsxs)("div",{className:"right chat-window",children:[Object(m.jsx)("div",{className:"right-row1 chat-header",children:(O||s)&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return f.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon",alt:"X icon"})}),Object(m.jsx)("div",{className:"chatTitle",children:k})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return R(!0)},children:Object(m.jsx)("img",{src:F,className:"icon",alt:"info icon"})})]})}),Object(m.jsx)("div",{className:"right-row2",ref:T,children:V||(n?Object(m.jsx)("div",{className:"greyed-out",children:"send a new message"}):Object(m.jsx)("div",{className:"greyed-out",children:"There are no messages to display. Please select a chat to display messages."}))}),Object(m.jsx)("div",{className:"right-row3",children:(V||n)&&Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),r&&d&&E.trim().length?"object"===typeof r&&r.url&&r.send(JSON.stringify({message:E,room_id:d})):r&&s&&E.trim().length&&(console.log("new chat sent: ",Object(o.a)(Object(o.a)({},s),{},{message:E})),r.send(JSON.stringify(Object(o.a)(Object(o.a)({},s),{},{message:E}))),J(!1)),L("")}(e)},autoComplete:"off",children:Object(m.jsx)("div",{children:Object(m.jsx)(C.a,{id:"outlined-basic",variant:"outlined",type:"text",disabled:M,placeholder:"Aa",value:E,onChange:function(e){return function(e){L(e.target.value)}(e)},autoFocus:!0})})})}),Object(m.jsx)(U,{modalOpen:G,setModalOpenProp:function(e){R(e)}})]})}var J=n.p+"static/media/group-icon.eb244b39.svg",D=n.p+"static/media/arrow-left.83aa775a.svg",q=(n(110),["new_message","add_participants","add_title","send_message"]);function G(e){var t=e.socket,n=e.onClickFriend,r=e.mobileViewSide,s=Object(w.g)(),a=Object(w.f)(),l=Object(i.c)((function(e){return e.status.friends})),d=new URLSearchParams(s.search),j=d.get("section")?d.get("section").trim():"",f=d.getAll("members"),O=d.get("group_name")?d.get("group_name").trim():"";switch(q.includes(j)||(j="new_message"),j){case"new_message":f=[],O="";break;case"send_message":if(f=f.filter((function(e){return l.includes(e)})),!O&&1===f.length)break;if(O&&f.length>1){console.log("yes!!");break}j="new_message",f=[];break;default:f=f.filter((function(e){return l.includes(e)}))}console.log("\nsection is",j);var p=Object(c.useState)(j),g=Object(u.a)(p,2),v=g[0],x=g[1],N=Object(c.useState)(O),y=Object(u.a)(N,2),S=y[0],_=y[1],F=Object(c.useState)(f),E=Object(u.a)(F,2),P=E[0],L=E[1],T=Object(c.useState)({newChat:!0,groupName:null,members:null}),A=Object(u.a)(T,2),U=A[0],G=A[1];Object(c.useEffect)((function(){var e=new URLSearchParams(s.search),t=e.get("section")?e.get("section").trim():"",n=e.getAll("members"),c=e.get("group_name")?e.get("group_name").trim():"";switch(q.includes(t)||(t="new_message"),t){case"new_message":n=[],c="";break;case"send_message":if(n=n.filter((function(e){return l.includes(e)})),!c&&1===n.length)break;if(c&&n.length>1){console.log("yes!!");break}t="new_message",n=[];break;default:n=n.filter((function(e){return l.includes(e)}))}x(t),_(c),L(n)}),[s.search,l]),Object(c.useEffect)((function(){G((function(e){return Object(o.a)(Object(o.a)({},e),{},{groupName:S,members:P})}))}),[P,S]),Object(c.useEffect)((function(){r&&h(r)}),[r]),Object(c.useEffect)((function(){h("right")}),[v]);var R=Object(m.jsxs)("div",{className:"NewChat right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return a.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon",alt:"x icon"})}),Object(m.jsx)("div",{children:"New message"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsxs)("div",{className:"create-new-group",onClick:function(){return a.push("/newchat?section=add_participants")},children:[Object(m.jsx)("div",{className:"iconContainer group",children:Object(m.jsx)("img",{src:J,className:"icon",alt:"group icon"})}),Object(m.jsx)("div",{children:"Create a New Group"})]}),Object(m.jsx)("div",{className:"suggested",children:"Suggested:"}),null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(H,{friend:e,onClickFriend:n})}))]})]}),V=Object(m.jsxs)("div",{className:"NewChat AddParticipants right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return a.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:D,className:"icon",alt:"left arrow"})}),"Add Participants"]}),Object(m.jsx)(k.a,{id:"next-button",onClick:function(){return a.push("/newchat?"+b("add_title",P,null,l))},disabled:P.length<2,children:"NEXT"})]}),Object(m.jsx)("div",{className:"right-row2",children:null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"friend-checkbox-container",children:Object(m.jsx)(H,{friend:e,onClickFriend:function(){return null},checked:P.find((function(t){return t===e})),changeCheck:function(){return t=e,void(P.find((function(e){return e==t}))?(console.log(t,"unchecking"),L(P.filter((function(e){return e!==t})))):(console.log(t,"checking"),L(P.concat([t]))));var t}})})})}))})]}),z=Object(m.jsxs)("div",{className:"NewChat AddTitle right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return a.push("/newchat?section=add_participants")},children:Object(m.jsx)("img",{src:D,className:"icon",alt:"left arrow"})}),"Add Title"]}),Object(m.jsx)(k.a,{id:"create-button",onClick:function(){return a.push("/newchat?"+b("send_message",P,S,l))},disabled:!S.trim(),children:"CREATE"})]}),Object(m.jsx)("div",{className:"right-row2",children:Object(m.jsx)("form",{id:"form1",onSubmit:function(e){!function(e){e.preventDefault(),(null===S||void 0===S?void 0:S.trim())&&a.push("newchat?"+b("send_message",P,S,l))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(C.a,{variant:"standard",type:"text",placeholder:"Group Name (Required)",required:"required",value:S,onChange:function(e){return _(e.target.value)}})})})})]}),X=Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(M,{inputOn:!0,newChatData:U,socket:t})});return"new_message"===v?R:"add_participants"===v?V:"add_title"===v?z:"send_message"===v?X:null}n(111);function R(){var e=Object(i.b)();e(P.setChatHistory(null));var t=Object(c.useState)(void 0),n=Object(u.a)(t,2),r=n[0],s=n[1],a=Object(c.useState)(void 0),o=Object(u.a)(a,2),l=o[0],d=o[1],j=Object(w.f)(),f=Object(i.c)((function(e){return e.userInfo}));function b(t){var n,c=t.target.value;fetch(N+"/chat_app/add_friend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+f.token},body:JSON.stringify({username:c})}).then((function(e){console.log(e.status,e.ok),e.ok&&e.json()})).then((function(t){console.log(t),n=l.map((function(e){return e.username===c?{username:c,isFriend:!0}:e})),d(n),e(P.addFriend(c))}))}Object(c.useEffect)((function(){h("right")}),[]),Object(c.useEffect)((function(){fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:r}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}),[r,f.token]);var O=Object(m.jsx)("div",{className:"right-row2>",children:null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(H,{friend:e.username,onClickFriend:function(){return null},isFriend:e.isFriend,addFriend:b})})}))});return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"right add-friend",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return j.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon",alt:"X"})}),Object(m.jsx)("div",{children:"Add friends"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:r}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(C.a,{variant:"standard",type:"text",placeholder:"search by username",required:"required",value:r,onChange:function(e){return function(e){s(e.target.value)}(e)}})})}),O]})]})})}var V=n(27),z=n.n(V),X=n(43);function B(e){var t,n,c=e.chat,r=Object(w.f)(),s=Object(i.c)((function(e){return e.userInfo})),a="/room/"+c.id,o=c.name?c.name:2===(null===(t=c.members)||void 0===t?void 0:t.length)?c.members.find((function(e){return e!==s.username})):void 0,l=null===c||void 0===c?void 0:c.members.filter((function(e){return e!==s.username}));return(null===(n=l)||void 0===n?void 0:n.length)>1&&(l=l.slice(0,2)),Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"chat",onClick:function(){return r.push(a)},children:[l.length>1?Object(m.jsx)("div",{className:"userIcon group",children:l.map((function(e){return Object(m.jsxs)("div",{className:"userIcon small",style:{backgroundColor:j(e)},children:[" ",e[0]," "]},e)}))}):l.map((function(e){return Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(e)},children:e[0]},e)})),o]})})}function K(e){var t=e.showChat,n=e.setChatHistoryProp,c=e.onClickFriend,r=Object(i.c)((function(e){return e.status.chats})),s=Object(i.c)((function(e){return e.status.friends}));return t?r?r.map((function(e){return Object(m.jsx)(B,{chat:e,setChatHistoryProp:n},e.id)})):"no chats":s?s.map((function(e){return Object(m.jsx)(H,{friend:e,onClickFriend:c},e)})):"no friends"}n(113);var Q=n.p+"static/media/chat-fill.c06d5871.svg",W=n.p+"static/media/people-fill.1ec4cb9a.svg";function Y(e){var t=e.ChatPeopleSwitch;return Object(m.jsxs)("div",{className:"ChatPeopleToggle",children:[Object(m.jsxs)("div",{onClick:function(){return t(!0)},children:[Object(m.jsx)("img",{className:"chat_fill",src:Q,alt:"Chat logo"}),Object(m.jsx)("div",{children:"Chat"})]}),Object(m.jsxs)("div",{onClick:function(){return t(!1)},children:[Object(m.jsx)("img",{className:"people_fill",src:W,alt:"People logo"}),Object(m.jsx)("div",{children:"People"})]})]})}var Z=n.p+"static/media/log-out.a1f930e4.svg",$=n.p+"static/media/pencil-fill.8f9e674f.svg",ee=n.p+"static/media/person-plus-fill.57f5c296.svg";n(114);function te(e){var t=e.setChatHistoryProp,n=e.rooms,r=e.onClickFriend,s=Object(w.f)(),a=Object(i.c)((function(e){return e.userInfo})),o=Object(c.useState)(!0),l=Object(u.a)(o,2),d=l[0],h=l[1];var b=Object(m.jsxs)("div",{className:"profile-page",children:[Object(m.jsxs)("div",{className:"profile-header",children:[Object(m.jsxs)("div",{className:"profile-header-left",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return O(!1)},children:Object(m.jsx)("img",{src:I,className:"icon",alt:"X icon"})}),Object(m.jsx)("div",{children:"Me"})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:Object(X.a)(z.a.mark((function e(){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(),void fetch(N+"/chat_app/logout",{headers:{authorization:"token "+a.token,"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("logged out"),console.log(e),window.location.reload()})).catch((function(e){return console.error(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),children:Object(m.jsx)("img",{src:Z,className:"icon",alt:"log out"})})]}),Object(m.jsx)("div",{className:"userIcon large",style:{backgroundColor:j(a.username)},children:a.username[0]}),Object(m.jsx)("div",{className:"profile-username",children:a.username})]});function O(e){var t=document.querySelector(".profile-page");t.style.display=e?"block":"none"}return Object(m.jsxs)("div",{className:"left Main",children:[b,Object(m.jsx)("div",{className:"left-row1",children:Object(m.jsxs)("div",{className:"Header",children:[Object(m.jsxs)("div",{className:"Header-left",children:[Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(a.username)},onClick:function(){return O(!0)},children:a.username[0]}),d?"Chats":"People"]}),Object(m.jsxs)("div",{className:"buttons",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return s.push("/addfriend")},children:Object(m.jsx)("img",{src:ee,className:"icon",alt:"add friend icon"})}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return s.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:$,className:"icon",alt:"pencil icon"})})]})]})}),Object(m.jsx)("div",{className:"left-row2",children:Object(m.jsx)(K,{onClickFriend:r,showChat:d,setChatHistoryProp:t,rooms:n})}),Object(m.jsx)("div",{className:"left-row3",children:Object(m.jsx)(Y,{ChatPeopleSwitch:function(e){h(e)}})})]})}var ne=n(81),ce=Object(p.a)({reducer:{userInfo:x.reducer,status:L.reducer}});function re(){var e=Object(w.f)(),t=Object(i.b)(),n=Object(i.c)((function(e){return e.userInfo})),r=Object(i.c)((function(e){return e.status.chats})),s=Object(i.c)((function(e){return e.status.currentChat})),a=Object(i.c)((function(e){return e.status.chatHistory})),d=Object(c.useState)({}),j=Object(u.a)(d,2),h=j[0],f=j[1];function b(t){var n,c=null===r||void 0===r||null===(n=r.find((function(e){return 2===e.members.length&&e.members.find((function(e){return e===t}))})))||void 0===n?void 0:n.id;c?e.push("/room/".concat(c)):(console.log("redirect",c),e.push("/newchat?section=send_message&members=".concat(t)))}return Object(c.useEffect)((function(){if(n.token){t(function(){var e=Object(X.a)(z.a.mark((function e(t){var n,c,r;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ce.getState(),console.log("general update state",n),c=function(){var e=Object(X.a)(z.a.mark((function e(){var t,c;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(N+"/chat_app/general_update",{method:"GET",headers:{Authorization:"token "+n.userInfo.token}});case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("GeneralUpdate failed");case 5:return e.next=7,t.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,console.log("\n\n\n general update \n\n\n"),e.next=7,c();case 7:r=e.sent,console.log(r.rooms),console.log(r.friends),t(P.setChats({chats:r.rooms})),t(P.setFriends({friends:r.friends})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.error(e.t0.message,"GeneralUpdate failed");case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}());var e=new ne.w3cwebsocket("wss://mk-chat-be.herokuapp.com/ws/chat/?token="+n.token);return f(e),function(){"close"in e&&(console.log("closing socket",e),e.close(),f({}))}}}),[n.token,t]),Object(c.useEffect)((function(){t(function(){var e=Object(X.a)(z.a.mark((function e(t){var n,c,r;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof Storage){e.next=4;break}return console.log("storage undefined"),t(v.setUserInfo({username:null,token:null,isLoading:!1})),e.abrupt("return");case 4:return localStorage.ChatUserInfo||(console.log("localStorage.ChatUserInfo is undefined"),t(v.setUserInfo({username:null,token:null,isLoading:!1}))),n=function(){var e=Object(X.a)(z.a.mark((function e(t){var n,c;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("stored info",t),e.next=3,fetch(N+"/chat_app/user_check",{method:"GET",headers:{Authorization:"token "+t.token}});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Could not fetch user info!");case 6:return e.next=8,n.json();case 8:if((c=e.sent).username){e.next=11;break}throw new Error("user check failed");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=JSON.parse(localStorage.ChatUserInfo),e.prev=7,e.next=10,n(c);case 10:r=e.sent,console.log("userData",r),t(v.setUserInfo({username:r.username,token:c.token,isLoading:!1})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error(e.t0.message,"fetchUserInfo failed"),t(v.setUserInfo({username:null,token:null,isLoading:!1}));case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}())}),[t]),Object(c.useEffect)((function(){if(s&&n.token){if(Object.keys(s).find((function(e){return"newChatMembers"===e}))){var c=Object(l.a)(s.newChatMembers);return void t(P.setChatHistory({members:c}))}fetch(N+"/chat_app/chat_update/"+s,{headers:{authorization:"token "+n.token}}).then((function(t){if(t.ok)return t.json();e.replace("/")})).then((function(e){return t(P.setChatHistory(e))})).catch((function(e){return console.error(e)}))}else t(P.setChatHistory(null))}),[s,n,t,e]),Object(c.useEffect)((function(){h.url&&(h.onopen=function(){console.log("connected to websocket")},h.onmessage=function(c){console.log("onmessage via websocket");var r=JSON.parse(c.data);console.log(r),r.newChat&&r.room?(t(P.addChat(r.room)),console.log("new room added",r.room),r.sender===(null===n||void 0===n?void 0:n.username)&&e.replace("room/".concat(r.room.id))):r.message.room_id==s&&a&&(t(P.setChatHistory(Object(o.a)(Object(o.a)({},a),{},{messages:[].concat(Object(l.a)(a.messages),[r.message])}))),console.log("new message appended"))})}),[h,s,a,r,n,t,e]),n.isLoading?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(O,{}),Object(m.jsx)("div",{children:"it may take up to 20 seconds to load the app..."})]}):n.token?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(te,{mobileViewSide:"left",onClickFriend:b}),Object(m.jsx)(w.b,{exact:!0,path:"/",children:n.token?Object(m.jsx)(M,{mobileViewSide:"left"}):Object(m.jsx)(w.a,{to:"/login"})}),Object(m.jsx)(w.b,{path:"/room/:room_id",children:Object(m.jsx)(M,{socket:h,mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/newchat",children:Object(m.jsx)(G,{socket:h,onClickFriend:b,mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/addfriend",children:Object(m.jsx)(R,{mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/login",children:Object(m.jsx)(y,{loggedIn:!0})}),Object(m.jsx)(w.b,{path:"/register",children:Object(m.jsx)(S,{loggedIn:!0})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(w.b,{path:"/login",children:Object(m.jsx)(y,{userInfo:null})}),Object(m.jsx)(w.b,{path:"/register",children:Object(m.jsx)(S,{userInfo:null})}),Object(m.jsx)(w.b,{path:"/",children:Object(m.jsx)(w.a,{to:"/login"})})]})}var se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,163)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),s(e),a(e)}))},ae=n(29);a.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(ae.b,{children:Object(m.jsx)(i.a,{store:ce,children:Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(ae.a,{children:Object(m.jsx)(re,{})})})})})}),document.getElementById("root")),se()}},[[118,1,2]]]);
//# sourceMappingURL=main.56662576.chunk.js.map