(this.webpackJsonpchat_fe=this.webpackJsonpchat_fe||[]).push([[0],{101:function(e,t,n){},103:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},119:function(e,t,n){"use strict";n.r(t);var c=n(0),s=n.n(c),r=n(32),a=n.n(r),i=n(15),o=(n(101),n(25)),l=n(16),u=n(7),d=(n(102),n(103),n(78));function j(e){var t,n=0,c=Object(d.a)(e);try{for(c.s();!(t=c.n()).done;){n+=t.value.charCodeAt(0)}}catch(s){c.e(s)}finally{c.f()}return{0:"#313E50",1:"#924C5D",2:"#C5867A",3:"#E1915E",4:"#E17F5E",5:"#85A47A"}[n%6]}function h(e){var t,n,c,s,r,a,i,o;if("left"===e)i="left",o="right";else{if("right"!==e)return void console.log("invalide viewSide for MobileViewSide function");i="right",o="left"}var u=document.querySelector(".".concat(i)),d=u.classList.value.split(/(\s+)/).filter((function(e){return e.trim().length>0})),j=Object(l.a)(new Set(d)),h=j.filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)}));(t=u.classList).remove.apply(t,Object(l.a)(d)),(n=u.classList).add.apply(n,[].concat(Object(l.a)(h),["ShowIfMobile"]));var f=document.querySelector(".".concat(o));f?(console.log("side hidden",f),d=null===f||void 0===f||null===(c=f.classList)||void 0===c||null===(s=c.value)||void 0===s?void 0:s.split(/(\s+)/).filter((function(e){return e.trim().length>0})),h=(j=Object(l.a)(new Set(d))).filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)})),(r=f.classList).remove.apply(r,Object(l.a)(d)),(a=f.classList).add.apply(a,[].concat(Object(l.a)(h),["HideIfMobile"]))):console.log("no side to hide")}function f(e){"undefined"!==typeof Storage?(localStorage.ChatUserInfo=e?JSON.stringify(e):null,console.log("user info saved in local storage")):console.log("unable to use localStorage")}function b(e,t,n,c){var s=new URLSearchParams;return e&&s.append("section",e),t.forEach((function(e){c.includes(e)&&s.append("members",e)})),(null===n||void 0===n?void 0:n.trim())&&s.append("group_name",n),s.toString()}var m=n(1);function g(){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"spinner-border",role:"status",children:Object(m.jsx)("span",{className:"sr-only",children:"Loading..."})})})}var O=n(45),p=Object(O.b)({name:"userInfo",initialState:{username:null,token:null,isLoading:!0},reducers:{setUserInfo:function(e,t){e.username=t.payload.username,e.token=t.payload.token,e.isLoading=t.payload.isLoading||!1===t.payload.isLoading?t.payload.isLoading:e.isLoading}}}),v=p.actions,x=p,k=n(157),w=n(156),C=n(18),N="https://mk-chat-be.herokuapp.com";function y(e){var t=e.loggedIn,n=Object(C.g)(),s=Object(i.b)(),r=Object(c.useState)(""),a=Object(u.a)(r,2),o=a[0],l=a[1],d=Object(c.useState)(""),j=Object(u.a)(d,2),h=j[0],b=j[1],O=Object(c.useState)(!1),p=Object(u.a)(O,2),x=p[0],y=p[1];function S(e,t){"username"===t?l(e.target.value):"password"===t&&b(e.target.value)}function _(e){var t=void 0,n=void 0;console.log(e),1===e?(t="visitor1",n="123"):2===e&&(t="visitor2",n="123"),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}).then((function(e){return e.json()})).then((function(e){console.log(e),y(!1),e.token?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):e.non_field_errors&&(console.log("error message",e.non_field_errors),alert(e.non_field_errors))}))}return t?Object(m.jsx)(C.a,{to:"/"}):Object(m.jsxs)("div",{className:"login",children:[Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h})}).then((function(e){return y(!1),e.json()})).then((function(e){console.log(e),(null===e||void 0===e?void 0:e.token)?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):(null===e||void 0===e?void 0:e.non_field_errors)&&(console.log("error message",e.non_field_errors),alert(e.non_field_errors))}))},className:"login-form",children:[Object(m.jsx)(w.a,{id:"outlined-basic",type:"text",placeholder:"id",autoComplete:"username",onChange:function(e){return S(e,"username")},value:o}),Object(m.jsx)(w.a,{id:"outlined-password-input",type:"password",autoComplete:"current-password",placeholder:"password",onChange:function(e){return S(e,"password")},value:h}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"log in"})]}),Object(m.jsx)("div",{children:"do not have an account yet?"}),Object(m.jsx)("div",{className:"creat-new-account",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return n.push("/register")},children:"Create a New Account"})}),Object(m.jsx)("div",{children:"want to try the app without registering?"}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(1)},children:"sign in as visitor1"})}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(2)},children:"sign in as visitor2"})}),x&&Object(m.jsx)(g,{})]})}function S(e){var t=e.loggedIn,n=Object(C.g)(),s=Object(i.b)(),r=Object(c.useState)(""),a=Object(u.a)(r,2),o=a[0],l=a[1],d=Object(c.useState)(""),j=Object(u.a)(d,2),h=j[0],b=j[1],O=Object(c.useState)(""),p=Object(u.a)(O,2),x=p[0],y=p[1],S=Object(c.useState)(!1),_=Object(u.a)(S,2),F=_[0],I=_[1];function E(e,t){"username"===t?l(e.target.value):"password"===t?b(e.target.value):"password2"==t&&y(e.target.value)}return t?Object(m.jsx)(C.a,{to:"/"}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"registration",children:[F&&Object(m.jsx)(g,{}),Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),I(!0),fetch(N+"/chat_app/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h,password2:x})}).then((function(e){return I(!1),e.json()})).then((function(e){console.log(e);var t=Object.keys(e);t.find((function(e){return"token"===e}))?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):t.find((function(e){return"error"===e}))&&(console.log("error message",e.error),alert(e.error))}))},children:[Object(m.jsx)(w.a,{id:"outlined-basic",autoComplete:"username",placeholder:"id",onChange:function(e){return E(e,"username")},value:o}),Object(m.jsx)(w.a,{id:"outlined-password-input",type:"password",autoComplete:"new-password",placeholder:"password",onChange:function(e){return E(e,"password")},value:h}),Object(m.jsx)(w.a,{id:"outlined-password-input 2",type:"password",autoComplete:"new-password",placeholder:"retype password",onChange:function(e){return E(e,"password2")},value:x}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"register"})]}),Object(m.jsxs)("div",{children:["Already registered? ",Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return n.push("/login")},children:"Go to sign in page"})]})]})})}var _=n(66),F=n.p+"static/media/x-lg.db763ca8.svg",I=n.p+"static/media/info.f4a46c68.svg";function E(e,t){return new Date(t.last_message.time).getTime()-new Date(e.last_message.time).getTime()}var P=Object(O.b)({name:"status",initialState:{chats:[],friends:[],currentChat:null,chatHistory:null},reducers:{setChats:function(e,t){e.chats=t.payload.chats.sort(E)},addChat:function(e,t){e.chats=[t.payload].concat(Object(l.a)(e.chats))},setFriends:function(e,t){e.friends=t.payload.friends},addFriend:function(e,t){e.friends.push(t.payload)},setCurrentChat:function(e,t){e.currentChat=t.payload},setChatHistory:function(e,t){e.chatHistory=t.payload}}}),H=P.actions,M=P,T=n(162),A=n(159);n(108);function L(e){var t=e.friend,n=e.onClickFriend,c=e.checked,s=e.changeCheck,r=e.isFriend,a=e.addFriend,i={backgroundColor:j(t)};return s||a?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend additional-field",onClick:function(){return n(t)},children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]}),s&&Object(m.jsx)("input",{type:"checkbox",checked:c,onChange:s}),a&&Object(m.jsx)(k.a,{value:t,disabled:r,onClick:function(e){return a(e)},children:r?"added":"add"})]})}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend",onClick:function(){return n(t)},children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]})})}function D(e){var t=Object(i.c)((function(e){var t;return null===(t=e.status.chatHistory)||void 0===t?void 0:t.members}));return t?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(T.a,{open:e.modalOpen,onClose:function(){return e.setModalOpenProp(!1)},container:function(){return document.querySelector(".chat-window")},style:{position:"absolute"},BackdropProps:{style:{position:"absolute"}},componentsProps:{style:{padding:"100"}},children:[Object(m.jsx)(A.a,{children:"members"}),t.map((function(e){return Object(m.jsx)(L,{friend:e,onClickFriend:function(){}},e)}))]})}):null}n(109);function U(e){var t,n=e.inputOn,s=e.socket,r=e.newChatData,a=e.mobileViewSide,d=Object(C.i)().room_id,j=Object(i.b)(),f=Object(C.g)(),b=Object(i.c)((function(e){return e.userInfo})),g=Object(i.c)((function(e){return e.status.chatHistory})),O=Object(i.c)((function(e){return e.status.currentChat})),p=Object(i.c)((function(e){return e.status.chats})),v=Object(c.useState)(null),x=Object(u.a)(v,2),k=x[0],N=x[1],y=Object(c.useState)(""),S=Object(u.a)(y,2),E=S[0],P=S[1],M=Object(c.useRef)(null),T=Object(c.useState)(!1),A=Object(u.a)(T,2),L=A[0],U=A[1],J=Object(c.useState)(!1),q=Object(u.a)(J,2),G=q[0],R=q[1];Object(c.useEffect)((function(){M.current.scrollTop=M.current.scrollHeight}),[g]),Object(c.useEffect)((function(){a&&h(a)}),[a]),Object(c.useEffect)((function(){return j(d?H.setCurrentChat(d):H.setCurrentChat(null)),function(){j(H.setCurrentChat(null))}}),[d,j]),Object(c.useEffect)((function(){(null===r||void 0===r?void 0:r.groupName)?N(r.groupName):(null===r||void 0===r?void 0:r.members)?N(r.members[0]):N(function(e,t,n){var c,s,r,a;if(e)return(null===(c=s=null===t||void 0===t?void 0:t.find((function(t){return t.id==e})))||void 0===c?void 0:c.name)?s.name:null===(r=s)||void 0===r||null===(a=r.members)||void 0===a?void 0:a.find((function(e){return e!==(null===n||void 0===n?void 0:n.username)}))}(O,p,b))}),[O,r,p,b]),Object(c.useEffect)((function(){if(null===r||void 0===r?void 0:r.members){var e=[].concat(Object(l.a)(r.members),[b.username]);j(H.setCurrentChat({newChatMembers:e}))}}),[r,b.username,j]);var V=null===g||void 0===g||null===(t=g.messages)||void 0===t?void 0:t.map((function(e){return b.username===e.sender?Object(m.jsxs)("div",{className:"message-block self",children:[Object(m.jsx)("div",{className:"container",children:Object(m.jsx)("div",{className:"content",children:e.content})}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time):Object(m.jsxs)("div",{className:"message-block other",children:[Object(m.jsx)("div",{className:"sender",children:e.sender}),Object(m.jsx)("div",{className:"content",children:e.content}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time)}));return Object(m.jsxs)("div",{className:"right chat-window",children:[Object(m.jsx)("div",{className:"right-row1 chat-header",children:(g||r)&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return f.push("/")},children:Object(m.jsx)("img",{src:F,className:"icon",alt:"X icon"})}),Object(m.jsx)("div",{className:"chatTitle",children:k})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return R(!0)},children:Object(m.jsx)("img",{src:I,className:"icon",alt:"info icon"})})]})}),Object(m.jsx)("div",{className:"right-row2",ref:M,children:V||(n?Object(m.jsx)("div",{className:"greyed-out",children:"send a new message"}):Object(m.jsx)("div",{className:"greyed-out",children:"There are no messages to display. Please select a chat to display messages."}))}),Object(m.jsx)("div",{className:"right-row3",children:(V||n)&&Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),s&&d&&E.trim().length?"object"===typeof s&&s.url&&s.send(JSON.stringify({message:E,room_id:d})):s&&r&&E.trim().length&&(console.log("new chat sent: ",Object(o.a)(Object(o.a)({},r),{},{message:E})),s.send(JSON.stringify(Object(o.a)(Object(o.a)({},r),{},{message:E}))),U(!1)),P("")}(e)},autoComplete:"off",children:Object(m.jsx)("div",{children:Object(m.jsx)(w.a,{id:"outlined-basic",variant:"outlined",type:"text",disabled:L,placeholder:"Aa",value:E,onChange:function(e){return function(e){P(e.target.value)}(e)},autoFocus:!0})})})}),Object(m.jsx)(D,{modalOpen:G,setModalOpenProp:function(e){R(e)}})]})}var J=n.p+"static/media/group-icon.eb244b39.svg",q=n.p+"static/media/arrow-left.83aa775a.svg",G=(n(110),["new_message","add_participants","add_title","send_message"]);function R(e){var t=e.socket,n=e.onClickFriend,s=e.mobileViewSide,r=Object(C.h)(),a=Object(C.g)(),l=Object(i.c)((function(e){return e.status.friends})),d=new URLSearchParams(r.search),j=d.get("section")?d.get("section").trim():"",f=d.getAll("members"),g=d.get("group_name")?d.get("group_name").trim():"";switch(G.includes(j)||(j="new_message"),j){case"new_message":f=[],g="";break;case"send_message":if(f=f.filter((function(e){return l.includes(e)})),!g&&1===f.length)break;if(g&&f.length>1){console.log("yes!!");break}j="new_message",f=[];break;default:f=f.filter((function(e){return l.includes(e)}))}console.log("\nsection is",j);var O=Object(c.useState)(j),p=Object(u.a)(O,2),v=p[0],x=p[1],N=Object(c.useState)(g),y=Object(u.a)(N,2),S=y[0],_=y[1],I=Object(c.useState)(f),E=Object(u.a)(I,2),P=E[0],H=E[1],M=Object(c.useState)({newChat:!0,groupName:null,members:null}),T=Object(u.a)(M,2),A=T[0],D=T[1];Object(c.useEffect)((function(){var e=new URLSearchParams(r.search),t=e.get("section")?e.get("section").trim():"",n=e.getAll("members"),c=e.get("group_name")?e.get("group_name").trim():"";switch(G.includes(t)||(t="new_message"),t){case"new_message":n=[],c="";break;case"send_message":if(n=n.filter((function(e){return l.includes(e)})),!c&&1===n.length)break;if(c&&n.length>1){console.log("yes!!");break}t="new_message",n=[];break;default:n=n.filter((function(e){return l.includes(e)}))}x(t),_(c),H(n)}),[r.search,l]),Object(c.useEffect)((function(){D((function(e){return Object(o.a)(Object(o.a)({},e),{},{groupName:S,members:P})}))}),[P,S]),Object(c.useEffect)((function(){s&&h(s)}),[s]),Object(c.useEffect)((function(){h("right")}),[v]);var R=Object(m.jsxs)("div",{className:"NewChat right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return a.push("/")},children:Object(m.jsx)("img",{src:F,className:"icon",alt:"x icon"})}),Object(m.jsx)("div",{children:"New message"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsxs)("div",{className:"create-new-group",onClick:function(){return a.push("/newchat?section=add_participants")},children:[Object(m.jsx)("div",{className:"iconContainer group",children:Object(m.jsx)("img",{src:J,className:"icon",alt:"group icon"})}),Object(m.jsx)("div",{children:"Create a New Group"})]}),Object(m.jsx)("div",{className:"suggested",children:"Suggested:"}),null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(L,{friend:e,onClickFriend:n})}))]})]}),V=Object(m.jsxs)("div",{className:"NewChat AddParticipants right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return a.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:q,className:"icon",alt:"left arrow"})}),"Add Participants"]}),Object(m.jsx)(k.a,{id:"next-button",onClick:function(){return a.push("/newchat?"+b("add_title",P,null,l))},disabled:P.length<2,children:"NEXT"})]}),Object(m.jsx)("div",{className:"right-row2",children:null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"friend-checkbox-container",children:Object(m.jsx)(L,{friend:e,onClickFriend:function(){return null},checked:P.find((function(t){return t===e})),changeCheck:function(){return t=e,void(P.find((function(e){return e==t}))?(console.log(t,"unchecking"),H(P.filter((function(e){return e!==t})))):(console.log(t,"checking"),H(P.concat([t]))));var t}})})})}))})]}),z=Object(m.jsxs)("div",{className:"NewChat AddTitle right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return a.push("/newchat?section=add_participants")},children:Object(m.jsx)("img",{src:q,className:"icon",alt:"left arrow"})}),"Add Title"]}),Object(m.jsx)(k.a,{id:"create-button",onClick:function(){return a.push("/newchat?"+b("send_message",P,S,l))},disabled:!S.trim(),children:"CREATE"})]}),Object(m.jsx)("div",{className:"right-row2",children:Object(m.jsx)("form",{id:"form1",onSubmit:function(e){!function(e){e.preventDefault(),(null===S||void 0===S?void 0:S.trim())&&a.push("newchat?"+b("send_message",P,S,l))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(w.a,{variant:"standard",type:"text",placeholder:"Group Name (Required)",required:"required",value:S,onChange:function(e){return _(e.target.value)}})})})})]}),X=Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(U,{inputOn:!0,newChatData:A,socket:t})});return"new_message"===v?R:"add_participants"===v?V:"add_title"===v?z:"send_message"===v?X:null}n(111);function V(){var e=Object(i.b)();e(H.setChatHistory(null));var t=Object(c.useState)(void 0),n=Object(u.a)(t,2),s=n[0],r=n[1],a=Object(c.useState)(void 0),o=Object(u.a)(a,2),l=o[0],d=o[1],j=Object(C.g)(),f=Object(i.c)((function(e){return e.userInfo}));function b(t){var n,c=t.target.value;fetch(N+"/chat_app/add_friend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+f.token},body:JSON.stringify({username:c})}).then((function(e){console.log(e.status,e.ok),e.ok&&e.json()})).then((function(t){console.log(t),n=l.map((function(e){return e.username===c?{username:c,isFriend:!0}:e})),d(n),e(H.addFriend(c))}))}Object(c.useEffect)((function(){h("right")}),[]),Object(c.useEffect)((function(){fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:s}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}),[s,f.token]);var g=Object(m.jsx)("div",{className:"right-row2>",children:null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(L,{friend:e.username,onClickFriend:function(){return null},isFriend:e.isFriend,addFriend:b})})}))});return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"right add-friend",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return j.push("/")},children:Object(m.jsx)("img",{src:F,className:"icon",alt:"X"})}),Object(m.jsx)("div",{children:"Add friends"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:s}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(w.a,{variant:"standard",type:"text",placeholder:"search by username",required:"required",value:s,onChange:function(e){return function(e){r(e.target.value)}(e)}})})}),g]})]})})}var z=n(28),X=n.n(z),B=n(43);n(113);function Y(e){var t=new Date,n=new Date(e),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],s=n.getMinutes()>9?n.getMinutes():"0".concat(n.getMinutes());return t.getFullYear()!==n.getFullYear()?"".concat(c," ").concat(n.getDate()," ").concat(n.getFullYear()):t.getMonth()!==n.getMonth()?"".concat(c," ").concat(n.getDate()):t.getDate()===n.getDate()?0===n.getHours()?"".concat(12,":",s," AM"):n.getHours()<12?"".concat(n.getHours(),":").concat(s," AM"):12===n.getHours()?"".concat(n.getHours(),":").concat(s," PM"):"".concat(n.getHours()-12,":").concat(s," PM"):"".concat(c," ").concat(n.getDate())}function K(e){var t,n,c,s,r=e.chat,a=Object(C.g)(),o=Object(i.c)((function(e){return e.userInfo})),l="/room/"+r.id,u=r.name?r.name:2===(null===(t=r.members)||void 0===t?void 0:t.length)?r.members.find((function(e){return e!==o.username})):void 0,d=null===r||void 0===r?void 0:r.members.filter((function(e){return e!==o.username}));return(null===(n=d)||void 0===n?void 0:n.length)>1&&(d=d.slice(0,2)),Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"chat",onClick:function(){return a.push(l)},children:[d.length>1?Object(m.jsx)("div",{className:"userIcon group",children:d.map((function(e){return Object(m.jsxs)("div",{className:"userIcon small",style:{backgroundColor:j(e)},children:[" ",e[0]," "]},e)}))}):d.map((function(e){return Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(e)},children:e[0]},e)})),Object(m.jsxs)("div",{style:{overflow:"hidden"},children:[Object(m.jsx)("div",{children:u}),Object(m.jsxs)("div",{className:"detail",children:[Object(m.jsx)("div",{className:"content",children:null===(c=r.last_message)||void 0===c?void 0:c.content}),(null===(s=r.last_message)||void 0===s?void 0:s.time)&&Object(m.jsxs)("div",{className:"time",children:[" \xa0","\xb7 ".concat(Y(r.last_message.time))]})]})]})]})})}function Q(e){var t=e.showChat,n=e.setChatHistoryProp,c=e.onClickFriend,s=Object(i.c)((function(e){return e.status.chats})),r=Object(i.c)((function(e){return e.status.friends}));return t?(null===s||void 0===s?void 0:s.length)?s.map((function(e){return Object(m.jsx)(K,{chat:e,setChatHistoryProp:n},e.id)})):"no chats exist for the user yet":(null===r||void 0===r?void 0:r.length)?r.map((function(e){return Object(m.jsx)(L,{friend:e,onClickFriend:c},e)})):"no friends exist for the user yet"}n(114);var W=n.p+"static/media/chat-fill.c06d5871.svg",Z=n.p+"static/media/people-fill.1ec4cb9a.svg";function $(e){var t=e.ChatPeopleSwitch;return Object(m.jsxs)("div",{className:"ChatPeopleToggle",children:[Object(m.jsxs)("div",{onClick:function(){return t(!0)},children:[Object(m.jsx)("img",{className:"chat_fill",src:W,alt:"Chat logo"}),Object(m.jsx)("div",{children:"Chat"})]}),Object(m.jsxs)("div",{onClick:function(){return t(!1)},children:[Object(m.jsx)("img",{className:"people_fill",src:Z,alt:"People logo"}),Object(m.jsx)("div",{children:"People"})]})]})}var ee=n.p+"static/media/log-out.a1f930e4.svg",te=n.p+"static/media/pencil-fill.8f9e674f.svg",ne=n.p+"static/media/person-plus-fill.57f5c296.svg";n(115);function ce(e){var t=e.setChatHistoryProp,n=e.rooms,s=e.onClickFriend,r=Object(C.g)(),a=Object(i.c)((function(e){return e.userInfo})),o=Object(c.useState)(!0),l=Object(u.a)(o,2),d=l[0],h=l[1];var b=Object(m.jsxs)("div",{className:"profile-page",children:[Object(m.jsxs)("div",{className:"profile-header",children:[Object(m.jsxs)("div",{className:"profile-header-left",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return g(!1)},children:Object(m.jsx)("img",{src:F,className:"icon",alt:"X icon"})}),Object(m.jsx)("div",{children:"Me"})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:Object(B.a)(X.a.mark((function e(){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(),void fetch(N+"/chat_app/logout",{headers:{authorization:"token "+a.token,"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("logged out"),console.log(e),window.location.reload()})).catch((function(e){return console.error(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),children:Object(m.jsx)("img",{src:ee,className:"icon",alt:"log out"})})]}),Object(m.jsx)("div",{className:"userIcon large",style:{backgroundColor:j(a.username)},children:a.username[0]}),Object(m.jsx)("div",{className:"profile-username",children:a.username})]});function g(e){var t=document.querySelector(".profile-page");t.style.display=e?"block":"none"}return Object(m.jsxs)("div",{className:"left Main",children:[b,Object(m.jsx)("div",{className:"left-row1",children:Object(m.jsxs)("div",{className:"Header",children:[Object(m.jsxs)("div",{className:"Header-left",children:[Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(a.username)},onClick:function(){return g(!0)},children:a.username[0]}),d?"Chats":"People"]}),Object(m.jsxs)("div",{className:"buttons",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return r.push("/addfriend")},children:Object(m.jsx)("img",{src:ne,className:"icon",alt:"add friend icon"})}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return r.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:te,className:"icon",alt:"pencil icon"})})]})]})}),Object(m.jsx)("div",{className:"left-row2",children:Object(m.jsx)(Q,{onClickFriend:s,showChat:d,setChatHistoryProp:t,rooms:n})}),Object(m.jsx)("div",{className:"left-row3",children:Object(m.jsx)($,{ChatPeopleSwitch:function(e){h(e)}})})]})}var se=n(81),re=Object(O.a)({reducer:{userInfo:x.reducer,status:M.reducer}});function ae(){var e=Object(C.g)(),t=Object(i.b)(),n=Object(i.c)((function(e){return e.userInfo})),s=Object(i.c)((function(e){return e.status.chats})),r=Object(i.c)((function(e){return e.status.currentChat})),a=Object(i.c)((function(e){return e.status.chatHistory})),d=Object(c.useState)({}),j=Object(u.a)(d,2),h=j[0],f=j[1];function b(t){var n,c=null===s||void 0===s||null===(n=s.find((function(e){return 2===e.members.length&&e.members.find((function(e){return e===t}))})))||void 0===n?void 0:n.id;c?e.push("/room/".concat(c)):(console.log("redirect",c),e.push("/newchat?section=send_message&members=".concat(t)))}return Object(c.useEffect)((function(){if(n.token){t(function(){var e=Object(B.a)(X.a.mark((function e(t){var n,c,s;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=re.getState(),console.log("general update state",n),c=function(){var e=Object(B.a)(X.a.mark((function e(){var t,c;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(N+"/chat_app/general_update",{method:"GET",headers:{Authorization:"token "+n.userInfo.token}});case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("GeneralUpdate failed");case 5:return e.next=7,t.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,console.log("\n\n\n general update \n\n\n"),e.next=7,c();case 7:s=e.sent,console.log(s.rooms),console.log(s.friends),t(H.setChats({chats:s.rooms})),t(H.setFriends({friends:s.friends})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.error(e.t0.message,"GeneralUpdate failed");case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}());var e=new se.w3cwebsocket("wss://mk-chat-be.herokuapp.com/ws/chat/?token="+n.token);return f(e),function(){"close"in e&&(console.log("closing socket",e),e.close(),f({}))}}}),[n.token,t]),Object(c.useEffect)((function(){t(function(){var e=Object(B.a)(X.a.mark((function e(t){var n,c,s;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof Storage){e.next=4;break}return console.log("storage undefined"),t(v.setUserInfo({username:null,token:null,isLoading:!1})),e.abrupt("return");case 4:return localStorage.ChatUserInfo||(console.log("localStorage.ChatUserInfo is undefined"),t(v.setUserInfo({username:null,token:null,isLoading:!1}))),n=function(){var e=Object(B.a)(X.a.mark((function e(t){var n,c;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("stored info",t),e.next=3,fetch(N+"/chat_app/user_check",{method:"GET",headers:{Authorization:"token "+t.token}});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Could not fetch user info!");case 6:return e.next=8,n.json();case 8:if((c=e.sent).username){e.next=11;break}throw new Error("user check failed");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=JSON.parse(localStorage.ChatUserInfo),e.prev=7,e.next=10,n(c);case 10:s=e.sent,console.log("userData",s),t(v.setUserInfo({username:s.username,token:c.token,isLoading:!1})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error(e.t0.message,"fetchUserInfo failed"),t(v.setUserInfo({username:null,token:null,isLoading:!1}));case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}())}),[t]),Object(c.useEffect)((function(){if(r&&n.token){if(Object.keys(r).find((function(e){return"newChatMembers"===e}))){var c=Object(l.a)(r.newChatMembers);return void t(H.setChatHistory({members:c}))}fetch(N+"/chat_app/chat_update/"+r,{headers:{authorization:"token "+n.token}}).then((function(t){if(t.ok)return t.json();e.replace("/")})).then((function(e){return t(H.setChatHistory(e))})).catch((function(e){return console.error(e)}))}else t(H.setChatHistory(null))}),[r,n,t,e]),Object(c.useEffect)((function(){var c;h.url&&(h.onopen=function(){console.log("connected to websocket")},h.onmessage=function(i){console.log("onmessage via websocket");var u=JSON.parse(i.data);console.log(u),u.newChat&&u.room?(t(H.addChat(u.room)),console.log("new room added",u.room),u.sender===(null===n||void 0===n?void 0:n.username)&&e.replace("room/".concat(u.room.id))):u.message.room_id==r&&a?(t(H.setChatHistory(Object(o.a)(Object(o.a)({},a),{},{messages:[].concat(Object(l.a)(a.messages),[u.message])}))),c=s.map((function(e){return e.id==u.message.room_id?Object(o.a)(Object(o.a)({},e),{},{last_message:{time:u.message.time,content:u.message.content,checked:!1}}):e})),t(H.setChats({chats:c})),console.log("new message appended")):(c=s.map((function(e){return e.id==u.message.room_id?Object(o.a)(Object(o.a)({},e),{},{last_message:{time:u.message.time,content:u.message.content,checked:!1}}):e})),t(H.setChats({chats:c})))})}),[h,r,a,s,n,t,e]),n.isLoading?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(g,{}),Object(m.jsx)("div",{children:"it may take up to 20 seconds to load the app..."})]}):n.token?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(ce,{mobileViewSide:"left",onClickFriend:b}),Object(m.jsx)(C.b,{exact:!0,path:"/",children:n.token?Object(m.jsx)(U,{mobileViewSide:"left"}):Object(m.jsx)(C.a,{to:"/login"})}),Object(m.jsx)(C.b,{path:"/room/:room_id",children:Object(m.jsx)(U,{socket:h,mobileViewSide:"right"})}),Object(m.jsx)(C.b,{path:"/newchat",children:Object(m.jsx)(R,{socket:h,onClickFriend:b,mobileViewSide:"right"})}),Object(m.jsx)(C.b,{path:"/addfriend",children:Object(m.jsx)(V,{mobileViewSide:"right"})}),Object(m.jsx)(C.b,{path:"/login",children:Object(m.jsx)(y,{loggedIn:!0})}),Object(m.jsx)(C.b,{path:"/register",children:Object(m.jsx)(S,{loggedIn:!0})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(C.b,{path:"/login",children:Object(m.jsx)(y,{userInfo:null})}),Object(m.jsx)(C.b,{path:"/register",children:Object(m.jsx)(S,{userInfo:null})}),Object(m.jsx)(C.b,{path:"/",children:Object(m.jsx)(C.a,{to:"/login"})})]})}var ie=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,164)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),s(e),r(e),a(e)}))},oe=n(31);a.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(oe.a,{children:Object(m.jsx)(i.a,{store:re,children:Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(C.d,{children:Object(m.jsx)(ae,{})})})})})}),document.getElementById("root")),ie()}},[[119,1,2]]]);
//# sourceMappingURL=main.185b7f81.chunk.js.map