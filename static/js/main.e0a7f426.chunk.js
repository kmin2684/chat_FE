(this.webpackJsonpchat_fe=this.webpackJsonpchat_fe||[]).push([[0],{31:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},42:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),r=n(23),o=n.n(r),i=(n(31),n(11)),a=n(10),l=n.n(a),u=n(2),d=n(9),j=n(14),h=n(24),b=(n(33),n(34),n(35),n(0));function f(e){var t=e.friend,n=e.onClickFriend,c={backgroundColor:L(t)};return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"friend",onClick:function(){return n(t)},children:[Object(b.jsx)("div",{className:"userIcon",style:c,children:t[0]}),t]})})}var m=n(3);function O(e){e.room,e.setChatHistoryProp;var t,n=e.chat,c=e.userInfo,s=Object(m.g)(),r="/room/"+n.id,o=n.name?n.name:2===n.members.length?n.members.find((function(e){return e!==c.username})):void 0,i=null===n||void 0===n?void 0:n.members.filter((function(e){return e!==c.username}));return(null===(t=i)||void 0===t?void 0:t.length)>1&&(i=i.slice(0,2)),Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"chat",onClick:function(){return s.push(r)},children:[i.length>1?Object(b.jsx)("div",{className:"userIcon group",children:i.map((function(e){return Object(b.jsxs)("div",{className:"userIcon small",style:{backgroundColor:L(e)},children:[" ",e[0]," "]})}))}):i.map((function(e){return Object(b.jsx)("div",{className:"userIcon",style:{backgroundColor:L(e)},children:e[0]})})),o]})})}function p(e){var t=e.showChat,n=e.setChatHistoryProp,c=(e.rooms,e.friends),s=e.chats,r=e.onClickFriend,o=e.userInfo;return t?s?s.map((function(e){return Object(b.jsx)(O,{userInfo:o,chat:e,setChatHistoryProp:n})})):"no chats":c?c.map((function(e){return Object(b.jsx)(f,{friend:e,onClickFriend:r})})):"no friends"}n(42);var v=n.p+"static/media/chat-fill.c06d5871.svg",g=n.p+"static/media/people-fill.1ec4cb9a.svg";function x(e){var t=e.ChatPeopleSwitch;return Object(b.jsxs)("div",{className:"ChatPeopleToggle",children:[Object(b.jsxs)("div",{onClick:function(){return t(!0)},children:[Object(b.jsx)("img",{className:"chat_fill",src:v}),Object(b.jsx)("div",{children:"Chat"})]}),Object(b.jsxs)("div",{onClick:function(){return t(!1)},children:[Object(b.jsx)("img",{className:"people_fill",src:g}),Object(b.jsx)("div",{children:"People"})]})]})}var C="https://mk-chat-be.herokuapp.com";function k(e){e.userInfo;var t=e.loggedIn,n=e.SetUserInfoProp,s=Object(m.g)(),r=Object(c.useState)(null),o=Object(u.a)(r,2),i=o[0],a=o[1],l=Object(c.useState)(null),d=Object(u.a)(l,2),j=d[0],h=d[1];function f(e,t){"username"===t?a(e.target.value):"password"===t&&h(e.target.value)}return t?Object(b.jsx)(m.a,{to:"/"}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault(),fetch(C+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:j})}).then((function(e){return e.json()})).then((function(e){console.log(e),e.token?(V({username:e.username,token:e.token}),n({username:e.username,token:e.token})):e.non_field_errors&&console.log("error message",e.non_field_errors)}))},children:[Object(b.jsx)("input",{type:"text",placeholder:"id",onChange:function(e){return f(e,"username")},value:i}),Object(b.jsx)("input",{type:"password",placeholder:"password",onChange:function(e){return f(e,"password")},value:j}),Object(b.jsx)("button",{type:"submit",children:"log in"})]}),Object(b.jsx)("div",{children:Object(b.jsx)("button",{onClick:function(){return s.push("/register")},children:"Create a New Account"})})]})}function w(e){e.userInfo;var t=e.loggedIn,n=e.SetUserInfoProp,s=Object(m.g)(),r=Object(c.useState)(null),o=Object(u.a)(r,2),i=o[0],a=o[1],l=Object(c.useState)(null),d=Object(u.a)(l,2),j=d[0],h=d[1],f=Object(c.useState)(null),O=Object(u.a)(f,2),p=O[0],v=O[1];function g(e,t){"username"===t?a(e.target.value):"password"===t?h(e.target.value):"password2"==t&&v(e.target.value)}return t?Object(b.jsx)(m.a,{to:"/"}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault(),fetch(C+"/chat_app/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:j,password2:p})}).then((function(e){return e.json()})).then((function(e){console.log(e);var t=Object.keys(e);t.find((function(e){return"token"===e}))?(V({username:e.username,token:e.token}),n({username:e.username,token:e.token})):t.find((function(e){return"error"===e}))&&console.log("error message",e.error)}))},children:[Object(b.jsx)("input",{type:"text",placeholder:"id",onChange:function(e){return g(e,"username")},value:i}),Object(b.jsx)("input",{type:"password",placeholder:"password",onChange:function(e){return g(e,"password")},value:j}),Object(b.jsx)("input",{type:"password",placeholder:"retype password",onChange:function(e){return g(e,"password2")},value:p}),Object(b.jsx)("button",{type:"submit",children:"register"})]}),Object(b.jsxs)("div",{children:["Already registered? ",Object(b.jsx)("button",{onClick:function(){return s.push("/login")},children:"Go to sign in page"})]})]})}var S=n(21),y=n.p+"static/media/x-lg.db763ca8.svg";n.p;function N(e){var t,n=e.setCurrentChatProp,s=e.chatHistory,r=(e.myID,e.inputOn),o=e.userInfo,a=e.socket,l=e.newChatData,d=e.mobileViewSide,j=e.chatTitle,h=Object(m.i)().room_id,f=Object(m.g)(),O=Object(c.useState)(""),p=Object(u.a)(O,2),v=p[0],g=p[1],x=Object(c.useRef)(null),C=Object(c.useState)(!1),k=Object(u.a)(C,2),w=k[0],N=k[1];Object(c.useEffect)((function(){x.current.scrollTop=x.current.scrollHeight}),[s]),Object(c.useEffect)((function(){d&&M(d)}),[d]),n(h||void 0);Intl.DateTimeFormat().resolvedOptions().timeZone;var I=null===s||void 0===s||null===(t=s.messages)||void 0===t?void 0:t.map((function(e){return o.username===e.sender?Object(b.jsxs)("div",{className:"message-block self",children:[Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"content",children:e.content})}),Object(b.jsx)("div",{className:"time",children:Object(b.jsx)(S.a,{datetime:e.time})})]}):Object(b.jsxs)("div",{className:"message-block other",children:[Object(b.jsx)("div",{className:"sender",children:e.sender}),Object(b.jsx)("div",{className:"content",children:e.content}),Object(b.jsx)("div",{className:"time",children:Object(b.jsx)(S.a,{datetime:e.time})})]})}));return Object(b.jsxs)("div",{className:"right",children:[Object(b.jsxs)("div",{className:"right-row1 chat-header",children:[l&&Object(b.jsx)("div",{onClick:function(){return f.push("/")},children:" home"}),(null===s||void 0===s?void 0:s.messages)&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)("div",{className:"iconContainer",onClick:function(){return f.push("/")},children:Object(b.jsx)("img",{src:y,className:"icon"})}),Object(b.jsx)("div",{children:j})]}),Object(b.jsx)("div",{children:"info"})]})]}),Object(b.jsx)("div",{className:"right-row2",ref:x,children:I||(r?"send a new message":"no message")}),Object(b.jsx)("div",{className:"right-row3",children:(I||r)&&Object(b.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),a&&h&&v.trim().length?"object"===typeof a&&a.send(JSON.stringify({message:v,room_id:h})):a&&l&&v.trim().length&&(console.log("new chat sent: ",Object(i.a)(Object(i.a)({},l),{},{message:v})),a.send(JSON.stringify(Object(i.a)(Object(i.a)({},l),{},{message:v}))),N(!1)),g("")}(e)},children:Object(b.jsx)("input",{disabled:w,type:"text",placeholder:"Aa",value:v,onChange:function(e){return function(e){g(e.target.value)}(e)}})})})]})}function I(e){var t=e.chatHistory,n=e.myID,s=(e.width,e.showChat,e.setChatHistoryProp),r=(e.ChatPeopleSwitch,e.rooms,e.friends),o=e.setCurrentChatProp,i=e.onClickFriend,a=Object(c.useState)("new_message"),l=Object(u.a)(a,2),d=l[0],j=l[1],h=Object(c.useState)(!1),f=Object(u.a)(h,2),m=(f[0],f[1],Object(c.useState)(null)),O=Object(u.a)(m,2),p=(O[0],O[1],Object(c.useState)(null)),v=Object(u.a)(p,2),g=v[0],x=v[1];Object(c.useEffect)((function(){M("send_message"!==d?"left":"right")}),[d]);var C=Object(c.useState)([]),k=Object(u.a)(C,2),w=k[0],S=k[1];var y=Object(b.jsxs)("div",{className:"NewChat left",children:[Object(b.jsxs)("div",{className:"left-row1",children:[Object(b.jsx)("div",{children:"New message"}),Object(b.jsx)("div",{children:Object(b.jsx)("button",{onClick:function(){return j("add_participants")},children:" Create a New Group "})})]}),Object(b.jsxs)("div",{className:"left-row2",children:[Object(b.jsx)("div",{children:"Suggested:"}),null===r||void 0===r?void 0:r.map((function(e){return Object(b.jsx)("div",{onClick:function(){return i({friend:e})},children:e})}))]})]}),I=Object(b.jsxs)("div",{className:"AddParticipants left",children:[Object(b.jsxs)("div",{className:"left-row1",children:[Object(b.jsx)("button",{onClick:function(){return j("new_message")},children:"back"}),"Add Participants",Object(b.jsx)("button",{onClick:function(){return j("add_title")},children:"NEXT"})]}),Object(b.jsx)("div",{className:"left-row2",children:null===r||void 0===r?void 0:r.map((function(e){return Object(b.jsx)(P,{label:e,value:w.find((function(t){return t===e})),changeCheck:function(){return t=e,void(w.find((function(e){return e==t}))?(console.log(t,"unchecking"),S(w.filter((function(e){return e!==t})))):(console.log(t,"checking"),S(w.concat([t]))));var t}})}))})]}),_=Object(b.jsxs)("div",{className:"AddTitle left",children:[Object(b.jsxs)("div",{className:"left-row1",children:[Object(b.jsx)("button",{onClick:function(){return j("add_participants")},children:"back"}),"Add Title",Object(b.jsx)("button",{onClick:function(){j("send_message"),x(!0)},children:" CREATE"})]}),Object(b.jsx)("div",{className:"left-row2",children:Object(b.jsx)("input",{type:"text",placeholder:"Group Name (Required)"})})]});return["new_message"===d?y:"add_participants"===d?I:"add_title"===d?_:"send_message"===d?Object(b.jsx)("div",{className:"NewChat left",children:" send a new message from the right window "}):null,Object(b.jsx)(N,{chatHistory:t,setChatHistoryProp:s,myID:n,inputOn:g,setCurrentChatProp:o})]}function P(e){var t=e.label,n=e.value,c=e.changeCheck;return Object(b.jsx)("div",{className:"group-participant",children:Object(b.jsxs)("label",{children:[t,Object(b.jsx)("input",{type:"checkbox",checked:n,onChange:c})]})})}function _(e){var t,n,s=e.chatHistory,r=e.myID,o=(e.width,e.showChat,e.setChatHistoryProp),i=(e.ChatPeopleSwitch,e.rooms,e.friends),a=e.setCurrentChatProp,l=e.socket,d=e.onClickFriend,j=e.SetChatHistoryProp,h=e.mobileViewSide;j(void 0);var f=Object(m.h)(),O=Object(m.g)(),p=Object(c.useState)("new_message"),v=Object(u.a)(p,2),g=v[0],x=v[1],C=Object(c.useState)(!1),k=Object(u.a)(C,2),w=(k[0],k[1],Object(c.useState)("")),S=Object(u.a)(w,2),y=S[0],I=S[1],P=Object(c.useState)(null),_=Object(u.a)(P,2),H=_[0],E=_[1],T=Object(c.useState)([]),A=Object(u.a)(T,2),D=A[0],U=A[1];Object(c.useEffect)((function(){h&&M(h)}),[h]),Object(c.useEffect)((function(){M("right")}),[g]);var J={newChat:!0,groupName:y,members:D};Object(c.useEffect)((function(){var e;(null===(e=f.state)||void 0===e?void 0:e.user)&&(console.log("location found",f.state.user),"send_message"!==g&&x("send_message"),H||E(!0),D.length<2&&f.state.user!==D[0]&&U([f.state.user]),I(""))}),[f]);var L=Object(b.jsxs)("div",{className:"NewChat right",children:[Object(b.jsxs)("div",{className:"right-row1",children:[Object(b.jsx)("div",{children:"New message"}),Object(b.jsxs)("div",{children:[Object(b.jsx)("button",{onClick:function(){return x("add_participants")},children:" Create a New Group "}),Object(b.jsx)("button",{onClick:function(){return O.push("/")},children:"home"})]})]}),Object(b.jsxs)("div",{className:"right-row2",children:[Object(b.jsx)("div",{children:"Suggested:"}),null===i||void 0===i?void 0:i.map((function(e){return Object(b.jsx)("div",{onClick:function(){return d(e)},children:e})}))]})]}),V=Object(b.jsxs)("div",{className:"AddParticipants right",children:[Object(b.jsxs)("div",{className:"right-row1",children:[Object(b.jsx)("button",{onClick:function(){return x("new_message")},children:"back"}),"Add Participants",Object(b.jsx)("button",{onClick:function(){return x("add_title")},disabled:D.length<2,children:"NEXT"})]}),Object(b.jsx)("div",{className:"right-row2",children:null===i||void 0===i?void 0:i.map((function(e){return Object(b.jsx)(F,{label:e,value:D.find((function(t){return t===e})),changeCheck:function(){return t=e,void(D.find((function(e){return e==t}))?(console.log(t,"unchecking"),U(D.filter((function(e){return e!==t})))):(console.log(t,"checking"),U(D.concat([t]))));var t}})}))})]}),G=Object(b.jsxs)("div",{className:"AddTitle right",children:[Object(b.jsxs)("div",{className:"right-row1",children:[Object(b.jsx)("button",{onClick:function(){return x("add_participants")},children:"back"}),"Add Title",Object(b.jsx)("button",{form:"form1",disabled:!y.trim(),children:" CREATE"})]}),Object(b.jsx)("div",{className:"right-row2",onSubmit:function(e){!function(e){e.preventDefault(),y.trim()&&(x("send_message"),E(!0))}(e)},children:Object(b.jsx)("form",{id:"form1",children:Object(b.jsx)("input",{type:"text",placeholder:"Group Name (Required)",required:"required",value:y,onChange:function(e){return I(e.target.value)}})})})]}),q=Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(N,{chatHistory:s,setChatHistoryProp:o,myID:r,inputOn:H,setCurrentChatProp:a,newChatData:J,socket:l})}),z="new_message"===g?L:"add_participants"===g?V:"add_title"===g?G:"send_message"===g?q:null;return(null===(t=f.state)||void 0===t?void 0:t.user)&&D.length<2&&(null===(n=f.state)||void 0===n?void 0:n.user)!==D[0]?Object(b.jsx)("div",{className:"right"}):z}function F(e){var t=e.label,n=e.value,c=e.changeCheck;return Object(b.jsx)("div",{className:"group-participant",children:Object(b.jsxs)("label",{children:[t,Object(b.jsx)("input",{type:"checkbox",checked:n,onChange:c})]})})}function H(e){var t=e.userInfo,n=e.friends,s=e.SetFriendsProp;(0,e.SetChatHistoryProp)(void 0);var r=Object(c.useState)(void 0),o=Object(u.a)(r,2),i=o[0],a=o[1],l=Object(c.useState)(void 0),j=Object(u.a)(l,2),h=j[0],f=j[1],O=Object(m.g)();Object(c.useEffect)((function(){M("right")}),[]);var p=Object(b.jsx)("div",{className:"right-row2>",children:null===h||void 0===h?void 0:h.map((function(e){return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{children:[e.username,e.isFriend?Object(b.jsx)("span",{children:"added"}):Object(b.jsx)("button",{onClick:function(e){return function(e){var c,r=e.target.value;fetch(C+"/chat_app/add_friend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+t.token},body:JSON.stringify({username:r})}).then((function(e){console.log(e.status,e.ok),e.ok&&e.json()})).then((function(e){console.log(e),c=h.map((function(e){return e.username===r?{username:r,isFriend:!0}:e})),f(c),s([].concat(Object(d.a)(n),[r]))}))}(e)},value:e.username,children:" Add"})]})})}))});return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"right",children:[Object(b.jsxs)("div",{className:"right-row1",children:[Object(b.jsx)("div",{children:Object(b.jsx)("button",{onClick:function(){return O.push("/")},children:"Home"})}),Object(b.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),fetch(C+"/chat_app/add_friend?"+new URLSearchParams({username:i}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+t.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),f(e)}))}(e)},children:Object(b.jsx)("input",{type:"text",placeholder:"search by username",value:i,onChange:function(e){return function(e){a(e.target.value)}(e)}})})]}),p]})})}var E=[{id:"1",users_id:["1","2"],last_message:{content:"message2",sender:"me",time:"now"}},{id:"2",users_id:["1","3"],last_message:{content:"message3",sender:"joe",time:"1min"}}],T=n.p+"static/media/log-out.a1f930e4.svg",A=n.p+"static/media/pencil-fill.8f9e674f.svg",D=n.p+"static/media/person-plus-fill.57f5c296.svg";function U(e){e.width;var t=e.showChat,n=e.setChatHistoryProp,c=e.ChatPeopleSwitch,s=e.rooms,r=e.friends,o=(e.mobileViewSide,e.chats),i=e.userInfo,a=e.setUserInfoProp,u=e.onClickFriend,d=Object(m.g)();var h=Object(b.jsxs)("div",{className:"profile-page",children:[Object(b.jsxs)("div",{className:"profile-header",children:[Object(b.jsxs)("div",{className:"profile-header-left",children:[Object(b.jsx)("div",{className:"iconContainer",onClick:function(){return f(!1)},children:Object(b.jsx)("img",{src:y,className:"icon"})}),Object(b.jsx)("div",{children:"Me"})]}),Object(b.jsx)("div",{className:"iconContainer",onClick:Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(),void fetch(C+"/chat_app/logout",{headers:{authorization:"token "+i.token,"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("logged out"),console.log(e),a(void 0)})).catch((function(e){return console.error(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),children:Object(b.jsx)("img",{src:T,className:"icon"})})]}),Object(b.jsx)("div",{className:"userIcon large",children:i.username[0]}),Object(b.jsx)("div",{className:"profile-username",children:i.username})]});function f(e){var t=document.querySelector(".profile-page");t.style.display=e?"block":"none"}return Object(b.jsxs)("div",{className:"left",children:[h,Object(b.jsx)("div",{className:"left-row1",children:Object(b.jsxs)("div",{className:"Header",children:[Object(b.jsxs)("div",{className:"Header-left",children:[Object(b.jsx)("div",{className:"userIcon",style:{backgroundColor:L(i.username)},onClick:function(){return f(!0)},children:i.username[0]}),t?"Chats":"People"]}),Object(b.jsxs)("div",{className:"buttons",children:[Object(b.jsx)("div",{className:"iconContainer",onClick:function(){return d.push("/addfriend")},children:Object(b.jsx)("img",{src:D,className:"icon"})}),Object(b.jsx)("div",{className:"iconContainer",onClick:function(){return d.push("/newchat")},children:Object(b.jsx)("img",{src:A,className:"icon"})})]})]})}),Object(b.jsx)("div",{className:"left-row2",children:Object(b.jsx)(p,{userInfo:i,onClickFriend:u,showChat:t,setChatHistoryProp:n,rooms:s,friends:r,chats:o})}),Object(b.jsx)("div",{className:"left-row3",children:Object(b.jsx)(x,{ChatPeopleSwitch:c})})]})}var J=n(26);function L(e){var t,n=0,c=Object(h.a)(e);try{for(c.s();!(t=c.n()).done;){n+=t.value.charCodeAt(0)}}catch(s){c.e(s)}finally{c.f()}return{0:"#313E50",1:"#924C5D",2:"#C5867A",3:"#E1915E",4:"#E17F5E",5:"#85A47A"}[n%6]}function M(e){var t,n,c,s,r,o,i,a;if("left"===e)i="left",a="right";else{if("right"!==e)return void console.log("invalide viewSide for MobileViewSide function");i="right",a="left"}var l=document.querySelector(".".concat(i)),u=l.classList.value.split(/(\s+)/).filter((function(e){return e.trim().length>0})),j=Object(d.a)(new Set(u)),h=j.filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)}));(t=l.classList).remove.apply(t,Object(d.a)(u)),(n=l.classList).add.apply(n,[].concat(Object(d.a)(h),["ShowIfMobile"]));var b=document.querySelector(".".concat(a));b?(console.log("side hidden",b),u=null===b||void 0===b||null===(c=b.classList)||void 0===c||null===(s=c.value)||void 0===s?void 0:s.split(/(\s+)/).filter((function(e){return e.trim().length>0})),h=(j=Object(d.a)(new Set(u))).filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)})),(r=b.classList).remove.apply(r,Object(d.a)(u)),(o=b.classList).add.apply(o,[].concat(Object(d.a)(h),["HideIfMobile"]))):console.log("no side to hide")}function V(e){"undefined"!==typeof Storage?(localStorage.ChatUserInfo=e?JSON.stringify(e):null,console.log("user info saved in local storage")):console.log("unable to use localStorage")}function G(){var e=Object(m.g)(),t=Object(c.useState)("1"),n=Object(u.a)(t,2),s=n[0],r=(n[1],Object(c.useState)("loading")),o=Object(u.a)(r,2),a=o[0],h=o[1],f=Object(c.useState)(void 0),O=Object(u.a)(f,2),p=O[0],v=O[1],g=Object(c.useState)(void 0),x=Object(u.a)(g,2),S=x[0],y=x[1],P=Object(c.useState)(void 0),F=Object(u.a)(P,2),T=F[0],A=F[1],D=Object(c.useState)(void 0),L=Object(u.a)(D,2),M=L[0],G=L[1],q=Object(c.useState)(!0),z=Object(u.a)(q,2),R=z[0],B=z[1],X=Object(c.useState)(void 0),Z=Object(u.a)(X,2),K=Z[0],Q=Z[1];function W(e){h(e)}function Y(e){Q(e)}Object(c.useEffect)((function(){a&&"object"===typeof a&&(console.log("typeof userInfo",typeof a),Object.keys(a).find((function(e){return"token"===e}))&&G(new J.w3cwebsocket("wss://mk-chat-be.herokuapp.com/ws/chat/?token="+a.token)))}),[a]),Object(c.useEffect)((function(){function e(){return(e=Object(j.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof Storage){e.next=27;break}if(!localStorage.ChatUserInfo){e.next=23;break}return e.prev=2,t=JSON.parse(localStorage.ChatUserInfo),console.log("storedInfo: ",t),e.next=7,fetch(C+"/chat_app/user_check",{method:"GET",headers:{Authorization:"token "+t.token}});case 7:return n=e.sent,e.next=10,n.json();case 10:if(!(c=e.sent).username){e.next=15;break}return V({username:c.username,token:t.token}),h({username:c.username,token:t.token}),e.abrupt("return");case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(2),localStorage.ChatUserInfo=null,console.error(e.t0);case 21:e.next=25;break;case 23:console.log("localStorage.ChatUserInfo is undefined"),h(null);case 25:e.next=28;break;case 27:console.log("storage undefined");case 28:h(null);case 29:case"end":return e.stop()}}),e,null,[[2,17]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(c.useEffect)((function(){function e(){return(e=Object(j.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a?null===(t=Object.keys(a))||void 0===t?void 0:t.find((function(e){return"token"===e})):null)){e.next=13;break}return e.next=4,fetch(C+"/chat_app/general_update",{method:"GET",headers:{Authorization:"token "+a.token}});case 4:return n=e.sent,e.next=7,n.json();case 7:c=e.sent,console.log("\n\n\n general update \n\n\n"),console.log(c),v(c.rooms),console.log("friends: ",c.friends,"chats: ",c.rooms),y(c.friends);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[a]);var $=Object(c.useState)({width:null}),ee=Object(u.a)($,2),te=ee[0],ne=(ee[1],te.width);function ce(e){B(!!e)}function se(e){A(e)}function re(t){var n,c=null===p||void 0===p||null===(n=p.find((function(e){return 2===e.members.length&&e.members.find((function(e){return e===t}))})))||void 0===n?void 0:n.id;c?e.push("/room/".concat(c)):(console.log("redirect",c),e.push({pathname:"/newchat",state:{user:t}}))}return Object(c.useEffect)((function(){T&&a?Object.keys(a).find((function(e){return"token"===e}))&&fetch(C+"/chat_app/chat_update/"+T,{headers:{authorization:"token "+a.token}}).then((function(e){return e.json()})).then((function(e){return Q(e)})):Q(void 0)}),[T,a]),Object(c.useEffect)((function(){var t;M&&"object"===typeof M&&(console.log(M),M.onopen=function(){console.log("connected to websocket")},M.onmessage=function(n){console.log("onmessage via websocket"),t=JSON.parse(n.data),console.log(t),Object.keys(t).find((function(e){return"newChat"===e}))?t.newChat&&t.room&&(console.log("chats",p),v([].concat(Object(d.a)(p),[t.room])),t.sender===a.username&&e.push("room/".concat(t.room.id))):t.message.room_id==T&&K&&Q(Object(i.a)(Object(i.a)({},K),{},{messages:[].concat(Object(d.a)(K.messages),[t.message])}))})}),[M,T,K,p]),"loading"===a?null:a?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(U,{width:ne,showChat:R,setChatHistoryProp:void 0,ChatPeopleSwitch:ce,rooms:E,friends:S,mobileViewSide:"left",chats:p,userInfo:a,setUserInfoProp:function(e){h(e)},onClickFriend:re}),Object(b.jsx)(m.b,{exact:!0,path:"/",children:a?Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(N,{chatHistory:void 0,myID:s,userInfo:a,setCurrentChatProp:se,mobileViewSide:"left"})}):Object(b.jsx)(m.a,{to:"/login"})}),Object(b.jsx)(m.b,{path:"/room/:room_id",children:Object(b.jsx)(N,{chatHistory:K,chatTitle:function(){var e,t,n,c;if(T)return(null===(e=t=null===p||void 0===p?void 0:p.find((function(e){return e.id==T})))||void 0===e?void 0:e.name)?t.name:null===(n=t)||void 0===n||null===(c=n.members)||void 0===c?void 0:c.find((function(e){return e!==a.username}))}(),setChatHistoryProp:void 0,setCurrentChatProp:se,myID:s,userInfo:a,socket:M,mobileViewSide:"right"})}),Object(b.jsx)(m.b,{path:"/newchat",children:Object(b.jsx)(_,{width:ne,showChat:R,ChatPeopleSwitch:ce,rooms:E,friends:S,setCurrentChatProp:se,socket:M,onClickFriend:re,SetChatHistoryProp:Y,mobileViewSide:"right"})}),Object(b.jsx)(m.b,{path:"/newchat2",children:Object(b.jsx)(I,{width:ne,showChat:R,ChatPeopleSwitch:ce,rooms:E,friends:S,setCurrentChatProp:se})}),Object(b.jsx)(m.b,{path:"/addfriend",children:Object(b.jsx)(H,{userInfo:a,friends:S,SetFriendsProp:function(e){y(e)},SetChatHistoryProp:Y,mobileViewSide:"right"})}),Object(b.jsx)(m.b,{path:"/login",children:Object(b.jsx)(k,{userInfo:null,loggedIn:!0})}),Object(b.jsx)(m.b,{path:"/register",children:Object(b.jsx)(w,{userInfo:null,loggedIn:!0})})]}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(m.b,{path:"/login",children:Object(b.jsx)(k,{userInfo:null,SetUserInfoProp:W})}),Object(b.jsx)(m.b,{path:"/register",children:Object(b.jsx)(w,{userInfo:null,SetUserInfoProp:W})}),Object(b.jsx)(m.b,{path:"/",children:Object(b.jsx)(m.a,{to:"/login"})})]})}var q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,47)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),c(e),s(e),r(e),o(e)}))},z=n(8);o.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(z.a,{children:Object(b.jsx)("div",{className:"App",children:Object(b.jsx)(m.d,{children:Object(b.jsx)(G,{})})})})}),document.getElementById("root")),q()}},[[46,1,2]]]);
//# sourceMappingURL=main.e0a7f426.chunk.js.map