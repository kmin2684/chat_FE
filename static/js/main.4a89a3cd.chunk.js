(this.webpackJsonpchat_fe=this.webpackJsonpchat_fe||[]).push([[0],{105:function(e,t,n){},107:function(e,t,n){},112:function(e,t,n){},114:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),s=n(32),a=n.n(s),i=n(15),o=(n(105),n(31)),l=n(16),u=n(8),d=(n(106),n(107),n(82));function j(e){var t,n=0,c=Object(d.a)(e);try{for(c.s();!(t=c.n()).done;){n+=t.value.charCodeAt(0)}}catch(r){c.e(r)}finally{c.f()}return{0:"#313E50",1:"#924C5D",2:"#C5867A",3:"#E1915E",4:"#E17F5E",5:"#85A47A"}[n%6]}function b(e){var t,n,c,r,s,a,i,o;if("left"===e)i="left",o="right";else{if("right"!==e)return void console.log("invalide viewSide for MobileViewSide function");i="right",o="left"}var u=document.querySelector(".".concat(i)),d=u.classList.value.split(/(\s+)/).filter((function(e){return e.trim().length>0})),j=Object(l.a)(new Set(d)),b=j.filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)}));(t=u.classList).remove.apply(t,Object(l.a)(d)),(n=u.classList).add.apply(n,[].concat(Object(l.a)(b),["ShowIfMobile"]));var f=document.querySelector(".".concat(o));f?(console.log("side hidden",f),d=null===f||void 0===f||null===(c=f.classList)||void 0===c||null===(r=c.value)||void 0===r?void 0:r.split(/(\s+)/).filter((function(e){return e.trim().length>0})),b=(j=Object(l.a)(new Set(d))).filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)})),(s=f.classList).remove.apply(s,Object(l.a)(d)),(a=f.classList).add.apply(a,[].concat(Object(l.a)(b),["HideIfMobile"]))):console.log("no side to hide")}function f(e){"undefined"!==typeof Storage?(localStorage.ChatUserInfo=e?JSON.stringify(e):null,console.log("user info saved in local storage")):console.log("unable to use localStorage")}var h=n(1),m=function(){return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("div",{className:"spinner-border",role:"status",children:Object(h.jsx)("span",{className:"sr-only",children:"Loading..."})})})},O=n(48),p=Object(O.b)({name:"userInfo",initialState:{username:null,token:null,isLoading:!0},reducers:{setUserInfo:function(e,t){e.username=t.payload.username,e.token=t.payload.token,e.isLoading=t.payload.isLoading||!1===t.payload.isLoading?t.payload.isLoading:e.isLoading},setIsLoading:function(e,t){e.isLoading=t.payload},increment:function(e){e.counter++},decrement:function(e){e.counter--},increase:function(e,t){e.counter=e.counter+t.payload},toggleCounter:function(e){e.showCounter=!e.showCounter}}}),g=p.actions,v=p,x=n(167),k=n(166),C=n(19),w="https://mk-chat-be.herokuapp.com";function N(e){var t=e.loggedIn,n=Object(C.g)(),r=Object(i.b)(),s=Object(c.useState)(null),a=Object(u.a)(s,2),o=a[0],l=a[1],d=Object(c.useState)(null),j=Object(u.a)(d,2),b=j[0],O=j[1],p=Object(c.useState)(!1),v=Object(u.a)(p,2),N=v[0],y=v[1];function S(e,t){"username"===t?l(e.target.value):"password"===t&&O(e.target.value)}function I(e){var t=void 0,n=void 0;console.log(e),1===e?(t="visitor1",n="123"):2===e&&(t="visitor2",n="123"),y(!0),fetch(w+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}).then((function(e){return e.json()})).then((function(e){console.log(e),y(!1),e.token?(f({username:e.username,token:e.token}),r(g.setUserInfo({username:e.username,token:e.token}))):e.non_field_errors&&console.log("error message",e.non_field_errors)}))}return t?Object(h.jsx)(C.a,{to:"/"}):Object(h.jsxs)("div",{className:"login",children:[Object(h.jsxs)("form",{onSubmit:function(e){e.preventDefault(),y(!0),fetch(w+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:b})}).then((function(e){return y(!1),e.json()})).then((function(e){console.log(e),(null===e||void 0===e?void 0:e.token)?(f({username:e.username,token:e.token}),r(g.setUserInfo({username:e.username,token:e.token}))):(null===e||void 0===e?void 0:e.non_field_errors)&&console.log("error message",e.non_field_errors)}))},className:"login-form",children:[Object(h.jsx)(k.a,{id:"outlined-basic",type:"text",placeholder:"id",onChange:function(e){return S(e,"username")},value:o}),Object(h.jsx)(k.a,{id:"outlined-password-input",type:"password",placeholder:"password",onChange:function(e){return S(e,"password")},value:b}),Object(h.jsx)(x.a,{variant:"contained",type:"submit",children:"log in"})]}),Object(h.jsx)("div",{children:"do not have an account yet?"}),Object(h.jsx)("div",{className:"creat-new-account",children:Object(h.jsx)(x.a,{variant:"contained",onClick:function(){return n.push("/register")},children:"Create a New Account"})}),Object(h.jsx)("div",{children:"want to try the app without registering?"}),Object(h.jsx)("div",{className:"visitor-sign-in",children:Object(h.jsx)(x.a,{variant:"contained",onClick:function(){return I(1)},children:"sign in as visitor1"})}),Object(h.jsx)("div",{className:"visitor-sign-in",children:Object(h.jsx)(x.a,{variant:"contained",onClick:function(){return I(2)},children:"sign in as visitor2"})}),N&&Object(h.jsx)(m,{})]})}function y(e){e.userInfo;var t=e.loggedIn,n=(e.SetUserInfoProp,Object(C.g)()),r=Object(i.b)(),s=Object(c.useState)(null),a=Object(u.a)(s,2),o=a[0],l=a[1],d=Object(c.useState)(null),j=Object(u.a)(d,2),b=j[0],O=j[1],p=Object(c.useState)(null),v=Object(u.a)(p,2),N=v[0],y=v[1],S=Object(c.useState)(!1),I=Object(u.a)(S,2),_=I[0],F=I[1];function E(e,t){"username"===t?l(e.target.value):"password"===t?O(e.target.value):"password2"==t&&y(e.target.value)}return t?Object(h.jsx)(C.a,{to:"/"}):Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{className:"registration",children:[_&&Object(h.jsx)(m,{}),Object(h.jsxs)("form",{onSubmit:function(e){e.preventDefault(),F(!0),fetch(w+"/chat_app/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:b,password2:N})}).then((function(e){return F(!1),e.json()})).then((function(e){console.log(e);var t=Object.keys(e);t.find((function(e){return"token"===e}))?(f({username:e.username,token:e.token}),r(g.setUserInfo({username:e.username,token:e.token}))):t.find((function(e){return"error"===e}))&&console.log("error message",e.error)}))},children:[Object(h.jsx)(k.a,{id:"outlined-basic",placeholder:"id",onChange:function(e){return E(e,"username")},value:o}),Object(h.jsx)(k.a,{id:"outlined-password-input",type:"password",placeholder:"password",onChange:function(e){return E(e,"password")},value:b}),Object(h.jsx)(k.a,{id:"outlined-password-input",type:"password",placeholder:"retype password",onChange:function(e){return E(e,"password2")},value:N}),Object(h.jsx)(x.a,{variant:"contained",type:"submit",children:"register"})]}),Object(h.jsxs)("div",{children:["Already registered? ",Object(h.jsx)(x.a,{variant:"contained",onClick:function(){return n.push("/login")},children:"Go to sign in page"})]})]})})}var S=n(60),I=n.p+"static/media/x-lg.db763ca8.svg",_=n.p+"static/media/info.f4a46c68.svg",F=Object(O.b)({name:"status",initialState:{chats:[],friends:[],currentChat:null,chatHistory:null},reducers:{setChats:function(e,t){e.chats=t.payload.chats},addChat:function(e,t){e.chats.push(t.payload)},setFriends:function(e,t){e.friends=t.payload.friends},addFriend:function(e,t){e.friends.push(t.payload)},setCurrentChat:function(e,t){e.currentChat=t.payload},setChatHistory:function(e,t){e.chatHistory=t.payload}}}),E=F.actions,P=F,T=n(172),L=n(169),H=n(165);n(112);function A(e){var t=e.friend,n=e.onClickFriend,c=e.checked,r=e.changeCheck,s=e.isFriend,a=e.addFriend,i={backgroundColor:j(t)};return r||a?Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{className:"friend additional-field",onClick:function(){return n(t)},children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]}),r&&Object(h.jsx)("input",{type:"checkbox",checked:c,onChange:r}),a&&Object(h.jsx)(x.a,{value:t,disabled:s,onClick:function(e){return a(e)},children:s?"added":"add"})]})}):Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{className:"friend",onClick:function(){return n(t)},children:[Object(h.jsx)("div",{className:"userIcon",style:i,children:t[0]}),t]})})}var U=Object(H.a)({topScrollPaper:{alignItems:"flex-start"}});function M(e){var t=Object(i.c)((function(e){var t;return null===(t=e.status.chatHistory)||void 0===t?void 0:t.members}));U();return t?Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)(T.a,{open:e.modalOpen,onClose:function(){return e.setModalOpenProp(!1)},container:function(){return document.querySelector(".chat-window")},style:{position:"absolute"},BackdropProps:{style:{position:"absolute"}},componentsProps:{style:{padding:"100"}},children:[Object(h.jsx)(L.a,{children:"members"}),t.map((function(e){return Object(h.jsx)(A,{friend:e,onClickFriend:function(){}})}))]})}):null}function D(e){var t,n=e.inputOn,r=e.socket,s=e.newChatData,a=e.mobileViewSide,d=Object(C.i)().room_id,j=Object(i.b)(),f=Object(C.g)(),m=Object(i.c)((function(e){return e.userInfo})),O=Object(i.c)((function(e){return e.status.chatHistory})),p=Object(i.c)((function(e){return e.status.currentChat})),g=Object(i.c)((function(e){return e.status.chats})),v=Object(c.useState)(null),x=Object(u.a)(v,2),w=x[0],N=x[1],y=Object(c.useState)(""),F=Object(u.a)(y,2),P=F[0],T=F[1],L=Object(c.useRef)(null),H=Object(c.useState)(!1),A=Object(u.a)(H,2),U=A[0],D=A[1],J=Object(c.useState)(!1),q=Object(u.a)(J,2),G=q[0],V=q[1];Object(c.useEffect)((function(){L.current.scrollTop=L.current.scrollHeight}),[O]),Object(c.useEffect)((function(){a&&b(a)}),[a]),Object(c.useEffect)((function(){return j(d?E.setCurrentChat(d):E.setCurrentChat(null)),function(){j(E.setCurrentChat(null))}}),[d]),Object(c.useEffect)((function(){(null===s||void 0===s?void 0:s.groupName)?N(s.groupName):(null===s||void 0===s?void 0:s.members)?N(s.members[0]):N(function(e,t,n){var c,r,s,a;if(e)return(null===(c=r=null===t||void 0===t?void 0:t.find((function(t){return t.id==e})))||void 0===c?void 0:c.name)?r.name:null===(s=r)||void 0===s||null===(a=s.members)||void 0===a?void 0:a.find((function(e){return e!==(null===n||void 0===n?void 0:n.username)}))}(p,g,m))}),[p,s,g]),Object(c.useEffect)((function(){if(null===s||void 0===s?void 0:s.members){var e=[].concat(Object(l.a)(s.members),[m.username]);j(E.setCurrentChat({newChatMembers:e}))}}),[s]);Intl.DateTimeFormat().resolvedOptions().timeZone;var z=null===O||void 0===O||null===(t=O.messages)||void 0===t?void 0:t.map((function(e){return m.username===e.sender?Object(h.jsxs)("div",{className:"message-block self",children:[Object(h.jsx)("div",{className:"container",children:Object(h.jsx)("div",{className:"content",children:e.content})}),Object(h.jsx)("div",{className:"time",children:Object(h.jsx)(S.a,{datetime:e.time})})]}):Object(h.jsxs)("div",{className:"message-block other",children:[Object(h.jsx)("div",{className:"sender",children:e.sender}),Object(h.jsx)("div",{className:"content",children:e.content}),Object(h.jsx)("div",{className:"time",children:Object(h.jsx)(S.a,{datetime:e.time})})]})}));return Object(h.jsxs)("div",{className:"right chat-window",children:[Object(h.jsx)("div",{className:"right-row1 chat-header",children:(O||s)&&Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return f.push("/")},children:Object(h.jsx)("img",{src:I,className:"icon"})}),Object(h.jsx)("div",{className:"chatTitle",children:w})]}),Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return V(!0)},children:Object(h.jsx)("img",{src:_,className:"icon"})})]})}),Object(h.jsx)("div",{className:"right-row2",ref:L,children:z||(n?Object(h.jsx)("div",{className:"greyed-out",children:"send a new message"}):Object(h.jsx)("div",{className:"greyed-out",children:"There are no messages to display. Please select a chat to display messages."}))}),Object(h.jsx)("div",{className:"right-row3",children:(z||n)&&Object(h.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),r&&d&&P.trim().length?"object"===typeof r&&r.url&&r.send(JSON.stringify({message:P,room_id:d})):r&&s&&P.trim().length&&(console.log("new chat sent: ",Object(o.a)(Object(o.a)({},s),{},{message:P})),r.send(JSON.stringify(Object(o.a)(Object(o.a)({},s),{},{message:P}))),D(!1)),T("")}(e)},autocomplete:"off",children:Object(h.jsx)("div",{children:Object(h.jsx)(k.a,{id:"outlined-basic",variant:"outlined",type:"text",disabled:U,placeholder:"Aa",value:P,onChange:function(e){return function(e){T(e.target.value)}(e)},autoFocus:!0})})})}),Object(h.jsx)(M,{modalOpen:G,setModalOpenProp:function(e){V(e)}})]})}var J=n.p+"static/media/group-icon.eb244b39.svg",q=n.p+"static/media/arrow-left.83aa775a.svg";function G(e){var t,n=e.socket,r=e.onClickFriend,s=e.mobileViewSide,a=Object(C.h)(),l=Object(C.g)(),d=(Object(i.b)(),Object(i.c)((function(e){return e.status.friends}))),j=Object(c.useState)("new_message"),f=Object(u.a)(j,2),m=f[0],O=f[1],p=Object(c.useState)(!1),g=Object(u.a)(p,2),v=(g[0],g[1],Object(c.useState)("")),w=Object(u.a)(v,2),N=w[0],y=w[1],S=Object(c.useState)(null),_=Object(u.a)(S,2),F=_[0],E=_[1],P=Object(c.useState)([]),T=Object(u.a)(P,2),L=T[0],H=T[1],U=Object(c.useState)({newChat:!0,groupName:null,members:null}),M=Object(u.a)(U,2),G=M[0],V=M[1];Object(c.useEffect)((function(){V(Object(o.a)(Object(o.a)({},G),{},{groupName:N,members:L}))}),[L,N]),Object(c.useEffect)((function(){s&&b(s)}),[s]),Object(c.useEffect)((function(){b("right")}),[m]),Object(c.useEffect)((function(){var e;(null===(e=a.state)||void 0===e?void 0:e.user)&&(console.log("location found",a.state.user),"send_message"!==m&&O("send_message"),F||E(!0),L.length<2&&a.state.user!==L[0]&&H([a.state.user]),y(""))}),[a]);var z=Object(h.jsxs)("div",{className:"NewChat right",children:[Object(h.jsxs)("div",{className:"right-row1",children:[Object(h.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return l.push("/")},children:Object(h.jsx)("img",{src:I,className:"icon"})}),Object(h.jsx)("div",{children:"New message"})]}),Object(h.jsxs)("div",{className:"right-row2",children:[Object(h.jsxs)("div",{className:"create-new-group",onClick:function(){return O("add_participants")},children:[Object(h.jsx)("div",{className:"iconContainer group",children:Object(h.jsx)("img",{src:J,className:"icon"})}),Object(h.jsx)("div",{children:"Create a New Group"})]}),Object(h.jsx)("div",{className:"suggested",children:"Suggested:"}),null===d||void 0===d?void 0:d.map((function(e){return Object(h.jsx)(A,{friend:e,onClickFriend:r})}))]})]}),R=Object(h.jsxs)("div",{className:"NewChat AddParticipants right",children:[Object(h.jsxs)("div",{className:"right-row1",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return O("new_message")},children:Object(h.jsx)("img",{src:q,className:"icon"})}),"Add Participants"]}),Object(h.jsx)(x.a,{id:"next-button",onClick:function(){return O("add_title")},disabled:L.length<2,children:"NEXT"})]}),Object(h.jsx)("div",{className:"right-row2",children:null===d||void 0===d?void 0:d.map((function(e){return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("div",{className:"friend-checkbox-container",children:Object(h.jsx)(A,{friend:e,onClickFriend:function(){return null},checked:L.find((function(t){return t===e})),changeCheck:function(){return t=e,void(L.find((function(e){return e==t}))?(console.log(t,"unchecking"),H(L.filter((function(e){return e!==t})))):(console.log(t,"checking"),H(L.concat([t]))));var t}})})})}))})]}),B=Object(h.jsxs)("div",{className:"NewChat AddTitle right",children:[Object(h.jsxs)("div",{className:"right-row1",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return O("add_participants")},children:Object(h.jsx)("img",{src:q,className:"icon"})}),"Add Title"]}),Object(h.jsx)(x.a,{id:"create-button",onClick:function(){N.trim()&&(O("send_message"),E(!0))},disabled:!N.trim(),children:"CREATE"})]}),Object(h.jsx)("div",{className:"right-row2",onSubmit:function(e){!function(e){console.log("onSubmit"),e.preventDefault(),N.trim()&&(O("send_message"),E(!0))}(e)},children:Object(h.jsx)("form",{id:"form1",children:Object(h.jsx)("div",{className:"text-field-container",children:Object(h.jsx)(k.a,{variant:"standard",type:"text",placeholder:"Group Name (Required)",required:"required",value:N,onChange:function(e){return y(e.target.value)}})})})})]}),X=Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(D,{inputOn:F,newChatData:G,socket:n})}),Z="new_message"===m?z:"add_participants"===m?R:"add_title"===m?B:"send_message"===m?X:null;return(null===(t=a.state)||void 0===t?void 0:t.user)&&"send_message"!==m?Object(h.jsx)("div",{className:"right"}):Z}function V(){var e=Object(i.b)();e(E.setChatHistory(null));var t=Object(c.useState)(void 0),n=Object(u.a)(t,2),r=n[0],s=n[1],a=Object(c.useState)(void 0),o=Object(u.a)(a,2),l=o[0],d=o[1],j=Object(C.g)(),f=Object(i.c)((function(e){return e.userInfo}));Object(i.c)((function(e){return e.friends}));function m(t){var n,c=t.target.value;fetch(w+"/chat_app/add_friend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+f.token},body:JSON.stringify({username:c})}).then((function(e){console.log(e.status,e.ok),e.ok&&e.json()})).then((function(t){console.log(t),n=l.map((function(e){return e.username===c?{username:c,isFriend:!0}:e})),d(n),e(E.addFriend(c))}))}Object(c.useEffect)((function(){b("right")}),[]),Object(c.useEffect)((function(){fetch(w+"/chat_app/add_friend?"+new URLSearchParams({username:r}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}),[r]);var O=Object(h.jsx)("div",{className:"right-row2>",children:null===l||void 0===l?void 0:l.map((function(e){return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(A,{friend:e.username,onClickFriend:function(){return null},isFriend:e.isFriend,addFriend:m})})}))});return Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{className:"right add-friend",children:[Object(h.jsxs)("div",{className:"right-row1",children:[Object(h.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return j.push("/")},children:Object(h.jsx)("img",{src:I,className:"icon"})}),Object(h.jsx)("div",{children:"Add friends"})]}),Object(h.jsxs)("div",{className:"right-row2",children:[Object(h.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),fetch(w+"/chat_app/add_friend?"+new URLSearchParams({username:r}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}(e)},children:Object(h.jsx)("div",{className:"text-field-container",children:Object(h.jsx)(k.a,{variant:"standard",type:"text",placeholder:"search by username",required:"required",value:r,onChange:function(e){return function(e){s(e.target.value)}(e)}})})}),O]})]})})}var z=n(27),R=n.n(z),B=n(46);function X(e){var t,n,c=e.chat,r=Object(C.g)(),s=Object(i.c)((function(e){return e.userInfo})),a="/room/"+c.id,o=c.name?c.name:2===(null===(t=c.members)||void 0===t?void 0:t.length)?c.members.find((function(e){return e!==s.username})):void 0,l=null===c||void 0===c?void 0:c.members.filter((function(e){return e!==s.username}));return(null===(n=l)||void 0===n?void 0:n.length)>1&&(l=l.slice(0,2)),Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{className:"chat",onClick:function(){return r.push(a)},children:[l.length>1?Object(h.jsx)("div",{className:"userIcon group",children:l.map((function(e){return Object(h.jsxs)("div",{className:"userIcon small",style:{backgroundColor:j(e)},children:[" ",e[0]," "]})}))}):l.map((function(e){return Object(h.jsx)("div",{className:"userIcon",style:{backgroundColor:j(e)},children:e[0]})})),o]})})}function Z(e){var t=e.showChat,n=e.setChatHistoryProp,c=(e.rooms,e.onClickFriend),r=(Object(i.c)((function(e){return e.userInfo})),Object(i.c)((function(e){return e.status.chats}))),s=Object(i.c)((function(e){return e.status.friends}));return t?r?r.map((function(e){return Object(h.jsx)(X,{chat:e,setChatHistoryProp:n})})):"no chats":s?s.map((function(e){return Object(h.jsx)(A,{friend:e,onClickFriend:c})})):"no friends"}n(114);var K=n.p+"static/media/chat-fill.c06d5871.svg",Q=n.p+"static/media/people-fill.1ec4cb9a.svg";function W(e){var t=e.ChatPeopleSwitch;return Object(h.jsxs)("div",{className:"ChatPeopleToggle",children:[Object(h.jsxs)("div",{onClick:function(){return t(!0)},children:[Object(h.jsx)("img",{className:"chat_fill",src:K}),Object(h.jsx)("div",{children:"Chat"})]}),Object(h.jsxs)("div",{onClick:function(){return t(!1)},children:[Object(h.jsx)("img",{className:"people_fill",src:Q}),Object(h.jsx)("div",{children:"People"})]})]})}var Y=n.p+"static/media/log-out.a1f930e4.svg",$=n.p+"static/media/pencil-fill.8f9e674f.svg",ee=n.p+"static/media/person-plus-fill.57f5c296.svg";function te(e){var t=e.setChatHistoryProp,n=e.rooms,r=e.onClickFriend,s=Object(C.g)(),a=Object(i.b)(),o=Object(i.c)((function(e){return e.userInfo})),l=Object(c.useState)(!0),d=Object(u.a)(l,2),b=d[0],m=d[1];var O=Object(h.jsxs)("div",{className:"profile-page",children:[Object(h.jsxs)("div",{className:"profile-header",children:[Object(h.jsxs)("div",{className:"profile-header-left",children:[Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return p(!1)},children:Object(h.jsx)("img",{src:I,className:"icon"})}),Object(h.jsx)("div",{children:"Me"})]}),Object(h.jsx)("div",{className:"iconContainer",onClick:Object(B.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(),void fetch(w+"/chat_app/logout",{headers:{authorization:"token "+o.token,"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("logged out"),console.log(e),a(g.setUserInfo({username:null,token:null}))})).catch((function(e){return console.error(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),children:Object(h.jsx)("img",{src:Y,className:"icon"})})]}),Object(h.jsx)("div",{className:"userIcon large",style:{backgroundColor:j(o.username)},children:o.username[0]}),Object(h.jsx)("div",{className:"profile-username",children:o.username})]});function p(e){var t=document.querySelector(".profile-page");t.style.display=e?"block":"none"}return Object(h.jsxs)("div",{className:"left",children:[O,Object(h.jsx)("div",{className:"left-row1",children:Object(h.jsxs)("div",{className:"Header",children:[Object(h.jsxs)("div",{className:"Header-left",children:[Object(h.jsx)("div",{className:"userIcon",style:{backgroundColor:j(o.username)},onClick:function(){return p(!0)},children:o.username[0]}),b?"Chats":"People"]}),Object(h.jsxs)("div",{className:"buttons",children:[Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return s.push("/addfriend")},children:Object(h.jsx)("img",{src:ee,className:"icon"})}),Object(h.jsx)("div",{className:"iconContainer",onClick:function(){return s.replace("/newchat")},children:Object(h.jsx)("img",{src:$,className:"icon"})})]})]})}),Object(h.jsx)("div",{className:"left-row2",children:Object(h.jsx)(Z,{onClickFriend:r,showChat:b,setChatHistoryProp:t,rooms:n})}),Object(h.jsx)("div",{className:"left-row3",children:Object(h.jsx)(W,{ChatPeopleSwitch:function(e){m(e)}})})]})}var ne=n(85),ce=Object(O.a)({reducer:{userInfo:v.reducer,status:P.reducer}});function re(){var e=Object(C.g)(),t=Object(i.b)(),n=Object(i.c)((function(e){return e.userInfo})),r=Object(i.c)((function(e){return e.status.chats})),s=(Object(i.c)((function(e){return e.status.friends})),Object(i.c)((function(e){return e.status.currentChat}))),a=Object(i.c)((function(e){return e.status.chatHistory})),d=Object(c.useState)({}),j=Object(u.a)(d,2),b=j[0],f=j[1];function m(t){var n,c=null===r||void 0===r||null===(n=r.find((function(e){return 2===e.members.length&&e.members.find((function(e){return e===t}))})))||void 0===n?void 0:n.id;c?e.push("/room/".concat(c)):(console.log("redirect",c),e.replace({pathname:"/newchat",state:{user:t}}))}return Object(c.useEffect)((function(){n.token&&f(new ne.w3cwebsocket("wss://mk-chat-be.herokuapp.com/ws/chat/?token="+n.token))}),[n.token]),Object(c.useEffect)((function(){t(function(){var e=Object(B.a)(R.a.mark((function e(t){var n,c,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof Storage){e.next=4;break}return console.log("storage undefined"),t(g.setUserInfo({username:null,token:null,isLoading:!1})),e.abrupt("return");case 4:return localStorage.ChatUserInfo||(console.log("localStorage.ChatUserInfo is undefined"),t(g.setUserInfo({username:null,token:null,isLoading:!1}))),n=function(){var e=Object(B.a)(R.a.mark((function e(t){var n,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("stored info",t),e.next=3,fetch(w+"/chat_app/user_check",{method:"GET",headers:{Authorization:"token "+t.token}});case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Could not fetch user info!");case 6:return e.next=8,n.json();case 8:if((c=e.sent).username){e.next=11;break}throw new Error("user check failed");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=JSON.parse(localStorage.ChatUserInfo),e.prev=7,e.next=10,n(c);case 10:r=e.sent,console.log("userData",r),t(g.setUserInfo({username:r.username,token:c.token,isLoading:!1})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error(e.t0.message,"fetchUserInfo failed"),t(g.setUserInfo({username:null,token:null,isLoading:!1}));case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(c.useEffect)((function(){return n.token&&t(function(){var e=Object(B.a)(R.a.mark((function e(t){var n,c,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ce.getState(),console.log("general update state",n),c=function(){var e=Object(B.a)(R.a.mark((function e(){var t,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(w+"/chat_app/general_update",{method:"GET",headers:{Authorization:"token "+n.userInfo.token}});case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("GeneralUpdate failed");case 5:return e.next=7,t.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,console.log("\n\n\n general update \n\n\n"),e.next=7,c();case 7:r=e.sent,console.log(r.rooms),console.log(r.friends),t(E.setChats({chats:r.rooms})),t(E.setFriends({friends:r.friends})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.error(e.t0.message,"GeneralUpdate failed");case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()),function(){f({})}}),[n.token]),Object(c.useEffect)((function(){if(s){if(n.token){if(Object.keys(s).find((function(e){return"newChatMembers"===e}))){var c=Object(l.a)(s.newChatMembers);return void t(E.setChatHistory({members:c}))}fetch(w+"/chat_app/chat_update/"+s,{headers:{authorization:"token "+n.token}}).then((function(t){if(t.ok)return t.json();e.replace("/")})).then((function(e){return t(E.setChatHistory(e))})).catch((function(e){return console.error(e)}))}}else t(E.setChatHistory(null))}),[s,n]),Object(c.useEffect)((function(){var c;console.log("socket is ",b),b.url&&(console.log(b),b.onopen=function(){console.log("connected to websocket")},b.onmessage=function(r){console.log("onmessage via websocket"),c=JSON.parse(r.data),console.log(c),c.newChat&&c.room?(t(E.addChat(c.room)),c.sender===(null===n||void 0===n?void 0:n.username)&&e.replace("room/".concat(c.room.id))):c.message.room_id==s&&a&&t(E.setChatHistory(Object(o.a)(Object(o.a)({},a),{},{messages:[].concat(Object(l.a)(a.messages),[c.message])})))})}),[b.url,s,a,r,n]),n.isLoading?null:n.token?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(te,{mobileViewSide:"left",onClickFriend:m}),Object(h.jsx)(C.b,{exact:!0,path:"/",children:n.token?Object(h.jsx)(D,{mobileViewSide:"left"}):Object(h.jsx)(C.a,{to:"/login"})}),Object(h.jsx)(C.b,{path:"/room/:room_id",children:Object(h.jsx)(D,{socket:b,mobileViewSide:"right"})}),Object(h.jsx)(C.b,{path:"/newchat",children:Object(h.jsx)(G,{socket:b,onClickFriend:m,mobileViewSide:"right"})}),Object(h.jsx)(C.b,{path:"/addfriend",children:Object(h.jsx)(V,{mobileViewSide:"right"})}),Object(h.jsx)(C.b,{path:"/login",children:Object(h.jsx)(N,{loggedIn:!0})}),Object(h.jsx)(C.b,{path:"/register",children:Object(h.jsx)(y,{loggedIn:!0})})]}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(C.b,{path:"/login",children:Object(h.jsx)(N,{userInfo:null})}),Object(h.jsx)(C.b,{path:"/register",children:Object(h.jsx)(y,{userInfo:null})}),Object(h.jsx)(C.b,{path:"/",children:Object(h.jsx)(C.a,{to:"/login"})})]})}var se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,174)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),s(e),a(e)}))},ae=n(29);a.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(ae.a,{children:Object(h.jsx)(i.a,{store:ce,children:Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(C.d,{children:Object(h.jsx)(re,{})})})})})}),document.getElementById("root")),se()}},[[118,1,2]]]);
//# sourceMappingURL=main.4a89a3cd.chunk.js.map