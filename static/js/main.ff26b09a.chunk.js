(this.webpackJsonpchat_fe=this.webpackJsonpchat_fe||[]).push([[0],{104:function(e,n,t){},106:function(e,n,t){},111:function(e,n,t){},112:function(e,n,t){},113:function(e,n,t){},114:function(e,n,t){},116:function(e,n,t){},117:function(e,n,t){},121:function(e,n,t){"use strict";t.r(n);var c=t(0),s=t.n(c),r=t(32),a=t.n(r),i=t(15),o=(t(104),t(30)),l=t(16),u=t(8),d=(t(105),t(106),t(81));function j(e){var n,t=0,c=Object(d.a)(e);try{for(c.s();!(n=c.n()).done;){t+=n.value.charCodeAt(0)}}catch(s){c.e(s)}finally{c.f()}return{0:"#313E50",1:"#924C5D",2:"#C5867A",3:"#E1915E",4:"#E17F5E",5:"#85A47A"}[t%6]}function h(e){var n,t,c,s,r,a,i,o;if("left"===e)i="left",o="right";else{if("right"!==e)return void console.log("invalide viewSide for MobileViewSide function");i="right",o="left"}var u=document.querySelector(".".concat(i)),d=u.classList.value.split(/(\s+)/).filter((function(e){return e.trim().length>0})),j=Object(l.a)(new Set(d)),h=j.filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)}));(n=u.classList).remove.apply(n,Object(l.a)(d)),(t=u.classList).add.apply(t,[].concat(Object(l.a)(h),["ShowIfMobile"]));var f=document.querySelector(".".concat(o));f?(console.log("side hidden",f),d=null===f||void 0===f||null===(c=f.classList)||void 0===c||null===(s=c.value)||void 0===s?void 0:s.split(/(\s+)/).filter((function(e){return e.trim().length>0})),h=(j=Object(l.a)(new Set(d))).filter((function(e){return!("HideIfMobile"===e||"ShowIfMobile"===e)})),(r=f.classList).remove.apply(r,Object(l.a)(d)),(a=f.classList).add.apply(a,[].concat(Object(l.a)(h),["HideIfMobile"]))):console.log("no side to hide")}function f(e){"undefined"!==typeof Storage?(localStorage.ChatUserInfo=e?JSON.stringify(e):null,console.log("user info saved in local storage")):console.log("unable to use localStorage")}function b(e,n,t,c){var s=new URLSearchParams;return e&&s.append("section",e),n.forEach((function(e){c.includes(e)&&s.append("members",e)})),(null===t||void 0===t?void 0:t.trim())&&s.append("group_name",t),s.toString()}var m=t(1),O=function(){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"spinner-border",role:"status",children:Object(m.jsx)("span",{className:"sr-only",children:"Loading..."})})})},g=t(48),p=Object(g.b)({name:"userInfo",initialState:{username:null,token:null,isLoading:!0},reducers:{setUserInfo:function(e,n){e.username=n.payload.username,e.token=n.payload.token,e.isLoading=n.payload.isLoading||!1===n.payload.isLoading?n.payload.isLoading:e.isLoading},setIsLoading:function(e,n){e.isLoading=n.payload},increment:function(e){e.counter++},decrement:function(e){e.counter--},increase:function(e,n){e.counter=e.counter+n.payload},toggleCounter:function(e){e.showCounter=!e.showCounter}}}),v=p.actions,x=p,k=t(171),C=t(170),w=t(19),N="https://mk-chat-be.herokuapp.com";function y(e){var n=e.loggedIn,t=Object(w.g)(),s=Object(i.b)(),r=Object(c.useState)(null),a=Object(u.a)(r,2),o=a[0],l=a[1],d=Object(c.useState)(null),j=Object(u.a)(d,2),h=j[0],b=j[1],g=Object(c.useState)(!1),p=Object(u.a)(g,2),x=p[0],y=p[1];function S(e,n){"username"===n?l(e.target.value):"password"===n&&b(e.target.value)}function _(e){var n=void 0,t=void 0;console.log(e),1===e?(n="visitor1",t="123"):2===e&&(n="visitor2",t="123"),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:t})}).then((function(e){return e.json()})).then((function(e){console.log(e),y(!1),e.token?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):e.non_field_errors&&console.log("error message",e.non_field_errors)}))}return n?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsxs)("div",{className:"login",children:[Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),y(!0),fetch(N+"/chat_app/api-token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h})}).then((function(e){return y(!1),e.json()})).then((function(e){console.log(e),(null===e||void 0===e?void 0:e.token)?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):(null===e||void 0===e?void 0:e.non_field_errors)&&console.log("error message",e.non_field_errors)}))},className:"login-form",children:[Object(m.jsx)(C.a,{id:"outlined-basic",type:"text",placeholder:"id",onChange:function(e){return S(e,"username")},value:o}),Object(m.jsx)(C.a,{id:"outlined-password-input",type:"password",placeholder:"password",onChange:function(e){return S(e,"password")},value:h}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"log in"})]}),Object(m.jsx)("div",{children:"do not have an account yet?"}),Object(m.jsx)("div",{className:"creat-new-account",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return t.push("/register")},children:"Create a New Account"})}),Object(m.jsx)("div",{children:"want to try the app without registering?"}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(1)},children:"sign in as visitor1"})}),Object(m.jsx)("div",{className:"visitor-sign-in",children:Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return _(2)},children:"sign in as visitor2"})}),x&&Object(m.jsx)(O,{})]})}function S(e){e.userInfo;var n=e.loggedIn,t=(e.SetUserInfoProp,Object(w.g)()),s=Object(i.b)(),r=Object(c.useState)(null),a=Object(u.a)(r,2),o=a[0],l=a[1],d=Object(c.useState)(null),j=Object(u.a)(d,2),h=j[0],b=j[1],g=Object(c.useState)(null),p=Object(u.a)(g,2),x=p[0],y=p[1],S=Object(c.useState)(!1),_=Object(u.a)(S,2),I=_[0],F=_[1];function E(e,n){"username"===n?l(e.target.value):"password"===n?b(e.target.value):"password2"==n&&y(e.target.value)}return n?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"registration",children:[I&&Object(m.jsx)(O,{}),Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),F(!0),fetch(N+"/chat_app/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:h,password2:x})}).then((function(e){return F(!1),e.json()})).then((function(e){console.log(e);var n=Object.keys(e);n.find((function(e){return"token"===e}))?(f({username:e.username,token:e.token}),s(v.setUserInfo({username:e.username,token:e.token}))):n.find((function(e){return"error"===e}))&&console.log("error message",e.error)}))},children:[Object(m.jsx)(C.a,{id:"outlined-basic",placeholder:"id",onChange:function(e){return E(e,"username")},value:o}),Object(m.jsx)(C.a,{id:"outlined-password-input",type:"password",placeholder:"password",onChange:function(e){return E(e,"password")},value:h}),Object(m.jsx)(C.a,{id:"outlined-password-input",type:"password",placeholder:"retype password",onChange:function(e){return E(e,"password2")},value:x}),Object(m.jsx)(k.a,{variant:"contained",type:"submit",children:"register"})]}),Object(m.jsxs)("div",{children:["Already registered? ",Object(m.jsx)(k.a,{variant:"contained",onClick:function(){return t.push("/login")},children:"Go to sign in page"})]})]})})}var _=t(69),I=t.p+"static/media/x-lg.db763ca8.svg",F=t.p+"static/media/info.f4a46c68.svg",E=Object(g.b)({name:"status",initialState:{chats:[],friends:[],currentChat:null,chatHistory:null},reducers:{setChats:function(e,n){e.chats=n.payload.chats},addChat:function(e,n){e.chats.push(n.payload)},setFriends:function(e,n){e.friends=n.payload.friends},addFriend:function(e,n){e.friends.push(n.payload)},setCurrentChat:function(e,n){e.currentChat=n.payload},setChatHistory:function(e,n){e.chatHistory=n.payload}}}),P=E.actions,L=E,T=t(176),A=t(173),H=t(169);t(111);function U(e){var n=e.friend,t=e.onClickFriend,c=e.checked,s=e.changeCheck,r=e.isFriend,a=e.addFriend,i={backgroundColor:j(n)};return s||a?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend additional-field",onClick:function(){return t(n)},children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:n[0]}),n]}),s&&Object(m.jsx)("input",{type:"checkbox",checked:c,onChange:s}),a&&Object(m.jsx)(k.a,{value:n,disabled:r,onClick:function(e){return a(e)},children:r?"added":"add"})]})}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"friend",onClick:function(){return t(n)},children:[Object(m.jsx)("div",{className:"userIcon",style:i,children:n[0]}),n]})})}var M=Object(H.a)({topScrollPaper:{alignItems:"flex-start"}});function D(e){var n=Object(i.c)((function(e){var n;return null===(n=e.status.chatHistory)||void 0===n?void 0:n.members}));M();return n?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(T.a,{open:e.modalOpen,onClose:function(){return e.setModalOpenProp(!1)},container:function(){return document.querySelector(".chat-window")},style:{position:"absolute"},BackdropProps:{style:{position:"absolute"}},componentsProps:{style:{padding:"100"}},children:[Object(m.jsx)(A.a,{children:"members"}),n.map((function(e){return Object(m.jsx)(U,{friend:e,onClickFriend:function(){}},e)}))]})}):null}t(112);function J(e){var n,t=e.inputOn,s=e.socket,r=e.newChatData,a=e.mobileViewSide,d=Object(w.i)().room_id,j=Object(i.b)(),f=Object(w.g)(),b=Object(i.c)((function(e){return e.userInfo})),O=Object(i.c)((function(e){return e.status.chatHistory})),g=Object(i.c)((function(e){return e.status.currentChat})),p=Object(i.c)((function(e){return e.status.chats})),v=Object(c.useState)(null),x=Object(u.a)(v,2),k=x[0],N=x[1],y=Object(c.useState)(""),S=Object(u.a)(y,2),E=S[0],L=S[1],T=Object(c.useRef)(null),A=Object(c.useState)(!1),H=Object(u.a)(A,2),U=H[0],M=H[1],J=Object(c.useState)(!1),q=Object(u.a)(J,2),G=q[0],R=q[1];Object(c.useEffect)((function(){T.current.scrollTop=T.current.scrollHeight}),[O]),Object(c.useEffect)((function(){a&&h(a)}),[a]),Object(c.useEffect)((function(){return j(d?P.setCurrentChat(d):P.setCurrentChat(null)),function(){j(P.setCurrentChat(null))}}),[d]),Object(c.useEffect)((function(){(null===r||void 0===r?void 0:r.groupName)?N(r.groupName):(null===r||void 0===r?void 0:r.members)?N(r.members[0]):N(function(e,n,t){var c,s,r,a;if(e)return(null===(c=s=null===n||void 0===n?void 0:n.find((function(n){return n.id==e})))||void 0===c?void 0:c.name)?s.name:null===(r=s)||void 0===r||null===(a=r.members)||void 0===a?void 0:a.find((function(e){return e!==(null===t||void 0===t?void 0:t.username)}))}(g,p,b))}),[g,r,p]),Object(c.useEffect)((function(){if(null===r||void 0===r?void 0:r.members){var e=[].concat(Object(l.a)(r.members),[b.username]);j(P.setCurrentChat({newChatMembers:e}))}}),[r]);Intl.DateTimeFormat().resolvedOptions().timeZone;var V=null===O||void 0===O||null===(n=O.messages)||void 0===n?void 0:n.map((function(e){return b.username===e.sender?Object(m.jsxs)("div",{className:"message-block self",children:[Object(m.jsx)("div",{className:"container",children:Object(m.jsx)("div",{className:"content",children:e.content})}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time):Object(m.jsxs)("div",{className:"message-block other",children:[Object(m.jsx)("div",{className:"sender",children:e.sender}),Object(m.jsx)("div",{className:"content",children:e.content}),Object(m.jsx)("div",{className:"time",children:Object(m.jsx)(_.a,{datetime:e.time})})]},e.time)}));return Object(m.jsxs)("div",{className:"right chat-window",children:[Object(m.jsx)("div",{className:"right-row1 chat-header",children:(O||r)&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return f.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon"})}),Object(m.jsx)("div",{className:"chatTitle",children:k})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return R(!0)},children:Object(m.jsx)("img",{src:F,className:"icon"})})]})}),Object(m.jsx)("div",{className:"right-row2",ref:T,children:V||(t?Object(m.jsx)("div",{className:"greyed-out",children:"send a new message"}):Object(m.jsx)("div",{className:"greyed-out",children:"There are no messages to display. Please select a chat to display messages."}))}),Object(m.jsx)("div",{className:"right-row3",children:(V||t)&&Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),s&&d&&E.trim().length?"object"===typeof s&&s.url&&s.send(JSON.stringify({message:E,room_id:d})):s&&r&&E.trim().length&&(console.log("new chat sent: ",Object(o.a)(Object(o.a)({},r),{},{message:E})),s.send(JSON.stringify(Object(o.a)(Object(o.a)({},r),{},{message:E}))),M(!1)),L("")}(e)},autoComplete:"off",children:Object(m.jsx)("div",{children:Object(m.jsx)(C.a,{id:"outlined-basic",variant:"outlined",type:"text",disabled:U,placeholder:"Aa",value:E,onChange:function(e){return function(e){L(e.target.value)}(e)},autoFocus:!0})})})}),Object(m.jsx)(D,{modalOpen:G,setModalOpenProp:function(e){R(e)}})]})}var q=t.p+"static/media/group-icon.eb244b39.svg",G=t.p+"static/media/arrow-left.83aa775a.svg";t(113);function R(e){var n,t=e.socket,s=e.onClickFriend,r=e.mobileViewSide,a=["new_message","add_participants","add_title","send_message"],l=Object(w.h)(),d=Object(w.g)(),j=(Object(i.b)(),Object(i.c)((function(e){return e.status.friends}))),f=new URLSearchParams(l.search),O=f.get("section")?f.get("section").trim():"",g=f.getAll("members"),p=f.get("group_name")?f.get("group_name").trim():"";switch(a.includes(O)||(O="new_message"),O){case"new_message":g=[],p="";break;case"send_message":if(g=g.filter((function(e){return j.includes(e)})),console.log("filtered members are",g,p,g.length),!p&&1===g.length)break;if(p&&g.length>1){console.log("yes!!");break}O="new_message",g=[];break;default:g=g.filter((function(e){return j.includes(e)}))}console.log("\nsection is",O);var v=Object(c.useState)(O),x=Object(u.a)(v,2),N=x[0],y=x[1],S=Object(c.useState)(p),_=Object(u.a)(S,2),F=_[0],E=_[1],P=Object(c.useState)(g),L=Object(u.a)(P,2),T=L[0],A=L[1],H=Object(c.useState)(!1),M=Object(u.a)(H,2),D=(M[0],M[1],Object(c.useState)(null)),R=Object(u.a)(D,2),V=R[0],z=R[1],B=Object(c.useState)({newChat:!0,groupName:null,members:null}),X=Object(u.a)(B,2),Z=X[0],K=X[1];Object(c.useEffect)((function(){console.log("newchat rerendering because location.search changed");var e=new URLSearchParams(l.search),n=e.get("section")?e.get("section").trim():"",t=e.getAll("members"),c=e.get("group_name")?e.get("group_name").trim():"";switch(a.includes(n)||(n="new_message"),n){case"new_message":t=[],c="";break;case"send_message":if(t=t.filter((function(e){return j.includes(e)})),!c&&1===t.length)break;if(c&&t.length>1){console.log("yes!!");break}n="new_message",t=[];break;default:t=t.filter((function(e){return j.includes(e)}))}y(n),E(c),A(t)}),[l.search]),Object(c.useEffect)((function(){K(Object(o.a)(Object(o.a)({},Z),{},{groupName:F,members:T}))}),[T,F]),Object(c.useEffect)((function(){r&&h(r)}),[r]),Object(c.useEffect)((function(){h("right")}),[N]),Object(c.useEffect)((function(){var e;(null===(e=l.state)||void 0===e?void 0:e.user)&&(console.log("location found",l.state.user),V||z(!0),T.length<2&&l.state.user!==T[0]&&A([l.state.user]),E(""),y("send_message"))}),[l]);var Q=Object(m.jsxs)("div",{className:"NewChat right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return d.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon"})}),Object(m.jsx)("div",{children:"New message"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsxs)("div",{className:"create-new-group",onClick:function(){return d.push("/newchat?section=add_participants")},children:[Object(m.jsx)("div",{className:"iconContainer group",children:Object(m.jsx)("img",{src:q,className:"icon"})}),Object(m.jsx)("div",{children:"Create a New Group"})]}),Object(m.jsx)("div",{className:"suggested",children:"Suggested:"}),null===j||void 0===j?void 0:j.map((function(e){return Object(m.jsx)(U,{friend:e,onClickFriend:s})}))]})]}),W=Object(m.jsxs)("div",{className:"NewChat AddParticipants right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return d.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:G,className:"icon"})}),"Add Participants"]}),Object(m.jsx)(k.a,{id:"next-button",onClick:function(){return d.push("/newchat?"+b("add_title",T,null,j))},disabled:T.length<2,children:"NEXT"})]}),Object(m.jsx)("div",{className:"right-row2",children:null===j||void 0===j?void 0:j.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"friend-checkbox-container",children:Object(m.jsx)(U,{friend:e,onClickFriend:function(){return null},checked:T.find((function(n){return n===e})),changeCheck:function(){return n=e,void(T.find((function(e){return e==n}))?(console.log(n,"unchecking"),A(T.filter((function(e){return e!==n})))):(console.log(n,"checking"),A(T.concat([n]))));var n}})})})}))})]}),Y=Object(m.jsxs)("div",{className:"NewChat AddTitle right",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return d.push("/newchat?section=add_participants")},children:Object(m.jsx)("img",{src:G,className:"icon"})}),"Add Title"]}),Object(m.jsx)(k.a,{id:"create-button",onClick:function(){return d.push("/newchat?"+b("send_message",T,F,j))},disabled:!F.trim(),children:"CREATE"})]}),Object(m.jsx)("div",{className:"right-row2",children:Object(m.jsx)("form",{id:"form1",onSubmit:function(e){!function(e){e.preventDefault(),(null===F||void 0===F?void 0:F.trim())&&d.push("newchat?"+b("send_message",T,F,j))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(C.a,{variant:"standard",type:"text",placeholder:"Group Name (Required)",required:"required",value:F,onChange:function(e){return E(e.target.value)}})})})})]}),$=Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(J,{inputOn:!0,newChatData:Z,socket:t})}),ee="new_message"===N?Q:"add_participants"===N?W:"add_title"===N?Y:"send_message"===N?$:null;return(null===(n=l.state)||void 0===n?void 0:n.user)&&"send_message"!==N?Object(m.jsx)("div",{className:"right"}):ee}t(114);function V(){var e=Object(i.b)();e(P.setChatHistory(null));var n=Object(c.useState)(void 0),t=Object(u.a)(n,2),s=t[0],r=t[1],a=Object(c.useState)(void 0),o=Object(u.a)(a,2),l=o[0],d=o[1],j=Object(w.g)(),f=Object(i.c)((function(e){return e.userInfo}));Object(i.c)((function(e){return e.friends}));function b(n){var t,c=n.target.value;fetch(N+"/chat_app/add_friend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+f.token},body:JSON.stringify({username:c})}).then((function(e){console.log(e.status,e.ok),e.ok&&e.json()})).then((function(n){console.log(n),t=l.map((function(e){return e.username===c?{username:c,isFriend:!0}:e})),d(t),e(P.addFriend(c))}))}Object(c.useEffect)((function(){h("right")}),[]),Object(c.useEffect)((function(){fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:s}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}),[s]);var O=Object(m.jsx)("div",{className:"right-row2>",children:null===l||void 0===l?void 0:l.map((function(e){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(U,{friend:e.username,onClickFriend:function(){return null},isFriend:e.isFriend,addFriend:b})})}))});return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"right add-friend",children:[Object(m.jsxs)("div",{className:"right-row1",children:[Object(m.jsx)("div",{className:"iconContainer xIconContainer",onClick:function(){return j.push("/")},children:Object(m.jsx)("img",{src:I,className:"icon"})}),Object(m.jsx)("div",{children:"Add friends"})]}),Object(m.jsxs)("div",{className:"right-row2",children:[Object(m.jsx)("form",{onSubmit:function(e){return function(e){e.preventDefault(),fetch(N+"/chat_app/add_friend?"+new URLSearchParams({username:s}),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"token "+f.token}}).then((function(e){return e.ok?e.json():null})).then((function(e){console.log(e),d(e)}))}(e)},children:Object(m.jsx)("div",{className:"text-field-container",children:Object(m.jsx)(C.a,{variant:"standard",type:"text",placeholder:"search by username",required:"required",value:s,onChange:function(e){return function(e){r(e.target.value)}(e)}})})}),O]})]})})}var z=t(27),B=t.n(z),X=t(46);function Z(e){var n,t,c=e.chat,s=Object(w.g)(),r=Object(i.c)((function(e){return e.userInfo})),a="/room/"+c.id,o=c.name?c.name:2===(null===(n=c.members)||void 0===n?void 0:n.length)?c.members.find((function(e){return e!==r.username})):void 0,l=null===c||void 0===c?void 0:c.members.filter((function(e){return e!==r.username}));return(null===(t=l)||void 0===t?void 0:t.length)>1&&(l=l.slice(0,2)),Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"chat",onClick:function(){return s.push(a)},children:[l.length>1?Object(m.jsx)("div",{className:"userIcon group",children:l.map((function(e){return Object(m.jsxs)("div",{className:"userIcon small",style:{backgroundColor:j(e)},children:[" ",e[0]," "]},e)}))}):l.map((function(e){return Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(e)},children:e[0]},e)})),o]})})}function K(e){var n=e.showChat,t=e.setChatHistoryProp,c=(e.rooms,e.onClickFriend),s=(Object(i.c)((function(e){return e.userInfo})),Object(i.c)((function(e){return e.status.chats}))),r=Object(i.c)((function(e){return e.status.friends}));return n?s?s.map((function(e){return Object(m.jsx)(Z,{chat:e,setChatHistoryProp:t},e.id)})):"no chats":r?r.map((function(e){return Object(m.jsx)(U,{friend:e,onClickFriend:c},e)})):"no friends"}t(116);var Q=t.p+"static/media/chat-fill.c06d5871.svg",W=t.p+"static/media/people-fill.1ec4cb9a.svg";function Y(e){var n=e.ChatPeopleSwitch;return Object(m.jsxs)("div",{className:"ChatPeopleToggle",children:[Object(m.jsxs)("div",{onClick:function(){return n(!0)},children:[Object(m.jsx)("img",{className:"chat_fill",src:Q}),Object(m.jsx)("div",{children:"Chat"})]}),Object(m.jsxs)("div",{onClick:function(){return n(!1)},children:[Object(m.jsx)("img",{className:"people_fill",src:W}),Object(m.jsx)("div",{children:"People"})]})]})}var $=t.p+"static/media/log-out.a1f930e4.svg",ee=t.p+"static/media/pencil-fill.8f9e674f.svg",ne=t.p+"static/media/person-plus-fill.57f5c296.svg";t(117);function te(e){var n=e.setChatHistoryProp,t=e.rooms,s=e.onClickFriend,r=Object(w.g)(),a=(Object(i.b)(),Object(i.c)((function(e){return e.userInfo}))),o=Object(c.useState)(!0),l=Object(u.a)(o,2),d=l[0],h=l[1];var b=Object(m.jsxs)("div",{className:"profile-page",children:[Object(m.jsxs)("div",{className:"profile-header",children:[Object(m.jsxs)("div",{className:"profile-header-left",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return O(!1)},children:Object(m.jsx)("img",{src:I,className:"icon"})}),Object(m.jsx)("div",{children:"Me"})]}),Object(m.jsx)("div",{className:"iconContainer",onClick:Object(X.a)(B.a.mark((function e(){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(),void fetch(N+"/chat_app/logout",{headers:{authorization:"token "+a.token,"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("logged out"),console.log(e),window.location.reload()})).catch((function(e){return console.error(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),children:Object(m.jsx)("img",{src:$,className:"icon"})})]}),Object(m.jsx)("div",{className:"userIcon large",style:{backgroundColor:j(a.username)},children:a.username[0]}),Object(m.jsx)("div",{className:"profile-username",children:a.username})]});function O(e){var n=document.querySelector(".profile-page");n.style.display=e?"block":"none"}return Object(m.jsxs)("div",{className:"left Main",children:[b,Object(m.jsx)("div",{className:"left-row1",children:Object(m.jsxs)("div",{className:"Header",children:[Object(m.jsxs)("div",{className:"Header-left",children:[Object(m.jsx)("div",{className:"userIcon",style:{backgroundColor:j(a.username)},onClick:function(){return O(!0)},children:a.username[0]}),d?"Chats":"People"]}),Object(m.jsxs)("div",{className:"buttons",children:[Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return r.push("/addfriend")},children:Object(m.jsx)("img",{src:ne,className:"icon"})}),Object(m.jsx)("div",{className:"iconContainer",onClick:function(){return r.push("/newchat?section=new_message")},children:Object(m.jsx)("img",{src:ee,className:"icon"})})]})]})}),Object(m.jsx)("div",{className:"left-row2",children:Object(m.jsx)(K,{onClickFriend:s,showChat:d,setChatHistoryProp:n,rooms:t})}),Object(m.jsx)("div",{className:"left-row3",children:Object(m.jsx)(Y,{ChatPeopleSwitch:function(e){h(e)}})})]})}var ce=t(84),se=Object(g.a)({reducer:{userInfo:x.reducer,status:L.reducer}});function re(){var e=Object(w.g)(),n=Object(i.b)(),t=Object(i.c)((function(e){return e.userInfo})),s=Object(i.c)((function(e){return e.status.chats})),r=(Object(i.c)((function(e){return e.status.friends})),Object(i.c)((function(e){return e.status.currentChat}))),a=Object(i.c)((function(e){return e.status.chatHistory})),d=Object(c.useState)({}),j=Object(u.a)(d,2),h=j[0],f=j[1];function b(n){var t,c=null===s||void 0===s||null===(t=s.find((function(e){return 2===e.members.length&&e.members.find((function(e){return e===n}))})))||void 0===t?void 0:t.id;c?e.push("/room/".concat(c)):(console.log("redirect",c),e.push("/newchat?section=send_message&members=".concat(n)))}return Object(c.useEffect)((function(){return t.token&&f(new ce.w3cwebsocket("wss://mk-chat-be.herokuapp.com/ws/chat/?token="+t.token)),function(){"close"in h&&(console.log("closing socket"),h.close())}}),[t.token]),Object(c.useEffect)((function(){n(function(){var e=Object(X.a)(B.a.mark((function e(n){var t,c,s;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof Storage){e.next=4;break}return console.log("storage undefined"),n(v.setUserInfo({username:null,token:null,isLoading:!1})),e.abrupt("return");case 4:return localStorage.ChatUserInfo||(console.log("localStorage.ChatUserInfo is undefined"),n(v.setUserInfo({username:null,token:null,isLoading:!1}))),t=function(){var e=Object(X.a)(B.a.mark((function e(n){var t,c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("stored info",n),e.next=3,fetch(N+"/chat_app/user_check",{method:"GET",headers:{Authorization:"token "+n.token}});case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("Could not fetch user info!");case 6:return e.next=8,t.json();case 8:if((c=e.sent).username){e.next=11;break}throw new Error("user check failed");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),c=JSON.parse(localStorage.ChatUserInfo),e.prev=7,e.next=10,t(c);case 10:s=e.sent,console.log("userData",s),n(v.setUserInfo({username:s.username,token:c.token,isLoading:!1})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error(e.t0.message,"fetchUserInfo failed"),n(v.setUserInfo({username:null,token:null,isLoading:!1}));case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(n){return e.apply(this,arguments)}}())}),[]),Object(c.useEffect)((function(){return t.token&&n(function(){var e=Object(X.a)(B.a.mark((function e(n){var t,c,s;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=se.getState(),console.log("general update state",t),c=function(){var e=Object(X.a)(B.a.mark((function e(){var n,c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(N+"/chat_app/general_update",{method:"GET",headers:{Authorization:"token "+t.userInfo.token}});case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("GeneralUpdate failed");case 5:return e.next=7,n.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,console.log("\n\n\n general update \n\n\n"),e.next=7,c();case 7:s=e.sent,console.log(s.rooms),console.log(s.friends),n(P.setChats({chats:s.rooms})),n(P.setFriends({friends:s.friends})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.error(e.t0.message,"GeneralUpdate failed");case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(n){return e.apply(this,arguments)}}()),function(){f({})}}),[t.token]),Object(c.useEffect)((function(){if(r){if(t.token){if(Object.keys(r).find((function(e){return"newChatMembers"===e}))){var c=Object(l.a)(r.newChatMembers);return void n(P.setChatHistory({members:c}))}fetch(N+"/chat_app/chat_update/"+r,{headers:{authorization:"token "+t.token}}).then((function(n){if(n.ok)return n.json();e.replace("/")})).then((function(e){return n(P.setChatHistory(e))})).catch((function(e){return console.error(e)}))}}else n(P.setChatHistory(null))}),[r,t]),Object(c.useEffect)((function(){h.url&&(h.onopen=function(){console.log("connected to websocket")},h.onmessage=function(c){console.log("onmessage via websocket");var s=JSON.parse(c.data);console.log(s),s.newChat&&s.room?(n(P.addChat(s.room)),console.log("new room added",s.room),s.sender===(null===t||void 0===t?void 0:t.username)&&e.replace("room/".concat(s.room.id))):s.message.room_id==r&&a&&(n(P.setChatHistory(Object(o.a)(Object(o.a)({},a),{},{messages:[].concat(Object(l.a)(a.messages),[s.message])}))),console.log("new message appended"))})}),[h.url,r,a,s,t]),t.isLoading?Object(m.jsx)(O,{}):t.token?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(te,{mobileViewSide:"left",onClickFriend:b}),Object(m.jsx)(w.b,{exact:!0,path:"/",children:t.token?Object(m.jsx)(J,{mobileViewSide:"left"}):Object(m.jsx)(w.a,{to:"/login"})}),Object(m.jsx)(w.b,{path:"/room/:room_id",children:Object(m.jsx)(J,{socket:h,mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/newchat",children:Object(m.jsx)(R,{socket:h,onClickFriend:b,mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/addfriend",children:Object(m.jsx)(V,{mobileViewSide:"right"})}),Object(m.jsx)(w.b,{path:"/login",children:Object(m.jsx)(y,{loggedIn:!0})}),Object(m.jsx)(w.b,{path:"/register",children:Object(m.jsx)(S,{loggedIn:!0})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(w.b,{path:"/login",children:Object(m.jsx)(y,{userInfo:null})}),Object(m.jsx)(w.b,{path:"/register",children:Object(m.jsx)(S,{userInfo:null})}),Object(m.jsx)(w.b,{path:"/",children:Object(m.jsx)(w.a,{to:"/login"})})]})}var ae=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,178)).then((function(n){var t=n.getCLS,c=n.getFID,s=n.getFCP,r=n.getLCP,a=n.getTTFB;t(e),c(e),s(e),r(e),a(e)}))},ie=t(31);a.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(ie.a,{children:Object(m.jsx)(i.a,{store:se,children:Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(w.d,{children:Object(m.jsx)(re,{})})})})})}),document.getElementById("root")),ae()}},[[121,1,2]]]);
//# sourceMappingURL=main.ff26b09a.chunk.js.map